<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Casa Care - Smart Home Maintenance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="calendar.css">
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="app">
        <!-- Header -->
        <div class="bg-white shadow-sm border-b sticky top-0 z-40">
            <div class="px-4 py-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-xl font-bold text-gray-900">Casa Care</h1>
                        <p class="text-sm text-gray-600" id="header-subtitle">Smart home maintenance</p>
                    </div>
                    <button onclick="showHomeInfo()" class="text-2xl hover:bg-gray-100 p-2 rounded-lg touch-btn">üè†</button>
                </div>
            </div>
        </div>

        <!-- Simplified Setup Form -->
<div id="setup-form" class="p-4 main-content">
    <div class="bg-white rounded-xl p-6 shadow-lg max-w-md mx-auto">
        <div class="text-center mb-6">
            <div class="text-4xl mb-4">üè†</div>
            <h2 class="text-xl font-bold text-gray-900 mb-2">Tell us about your home</h2>
            <p class="text-gray-600 text-sm">We'll create a personalized maintenance plan</p>
        </div>
        
        <div class="space-y-6">
            <!-- Address -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Street Address</label>
                <input type="text" id="address" placeholder="123 Main Street" 
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-base">
            </div>

            <!-- City, State, Zip -->
            <div class="grid grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">City</label>
                    <input type="text" id="city" placeholder="Anytown" 
                           class="w-full px-3 py-3 border border-gray-300 rounded-lg text-base">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">State</label>
                    <input type="text" id="state" placeholder="NY" maxlength="2"
                           class="w-full px-3 py-3 border border-gray-300 rounded-lg text-base">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Zip Code</label>
                    <input type="text" id="zipcode" placeholder="12345" 
                           class="w-full px-3 py-3 border border-gray-300 rounded-lg text-base">
                </div>
            </div>

            <!-- Property Info -->
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Property Type</label>
                    <select id="property-type" class="w-full px-3 py-3 border border-gray-300 rounded-lg text-base">
                        <option value="single-family">Single Family Home</option>
                        <option value="townhouse">Townhouse</option>
                        <option value="condo">Condo</option>
                        <option value="apartment">Apartment</option>
                        <option value="mobile-home">Mobile Home</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Year Built</label>
                    <input type="number" id="year-built" value="1995" min="1900" max="2025"
                           class="w-full px-3 py-3 border border-gray-300 rounded-lg text-base">
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Square Feet</label>
                <input type="number" id="sqft" value="2000" min="500" max="10000"
                       class="w-full px-3 py-3 border border-gray-300 rounded-lg text-base">
            </div>

            <!-- Heating & Cooling Systems -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-3">Heating & Cooling Systems</label>
                <div class="space-y-3 bg-gray-50 p-4 rounded-lg">
                    <label class="flex items-center space-x-3 touch-btn">
                        <input type="checkbox" id="central-ac" class="w-5 h-5">
                        <span>Central Air/Heat</span>
                    </label>
                    <label class="flex items-center space-x-3 touch-btn">
                        <input type="checkbox" id="mini-splits" class="w-5 h-5">
                        <span>Mini-Split Systems</span>
                    </label>
                    <label class="flex items-center space-x-3 touch-btn">
                        <input type="checkbox" id="wall-ac" class="w-5 h-5">
                        <span>Wall Air Conditioners</span>
                    </label>
                    <label class="flex items-center space-x-3 touch-btn">
                        <input type="checkbox" id="electric-baseboard" class="w-5 h-5">
                        <span>Electric Baseboard Heat</span>
                    </label>
                    <label class="flex items-center space-x-3 touch-btn">
                        <input type="checkbox" id="boiler" class="w-5 h-5">
                        <span>Boiler System</span>
                    </label>
                </div>
            </div>

           <!-- Water & Sewer Systems -->
<div>
    <label class="block text-sm font-medium text-gray-700 mb-3">Water & Sewer Systems</label>
    <div class="space-y-3 bg-gray-50 p-4 rounded-lg">
        <label class="flex items-center space-x-3 touch-btn">
            <input type="checkbox" id="municipal-water" class="w-5 h-5">
            <span>Municipal Water</span>
        </label>
        <label class="flex items-center space-x-3 touch-btn">
            <input type="checkbox" id="well-water" class="w-5 h-5" onchange="toggleWellWaterOptions()">
            <span>Well Water</span>
        </label>
        <!-- Well Water Sub-options -->
        <div id="well-water-options" class="ml-8 space-y-2 hidden">
            <label class="flex items-center space-x-3 touch-btn">
                <input type="checkbox" id="sediment-filter" class="w-4 h-4">
                <span class="text-sm">Sediment Filtration</span>
            </label>
            <label class="flex items-center space-x-3 touch-btn">
                <input type="checkbox" id="uv-filter" class="w-4 h-4">
                <span class="text-sm">UV Filtration</span>
            </label>
            <label class="flex items-center space-x-3 touch-btn">
                <input type="checkbox" id="water-softener" class="w-4 h-4">
                <span class="text-sm">Water Softener</span>
            </label>
            <label class="flex items-center space-x-3 touch-btn">
                <input type="checkbox" id="whole-house-filter" class="w-4 h-4">
                <span class="text-sm">Whole House Filter</span>
            </label>
        </div>
        <label class="flex items-center space-x-3 touch-btn">
            <input type="checkbox" id="municipal-sewer" class="w-5 h-5">
            <span>Municipal Sewer</span>
        </label>
        <label class="flex items-center space-x-3 touch-btn">
            <input type="checkbox" id="septic" class="w-5 h-5">
            <span>Septic System</span>
        </label>
    </div>
</div>
            <!-- Other Home Features -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-3">Other Home Features</label>
                <div class="space-y-3 bg-gray-50 p-4 rounded-lg">
                    <label class="flex items-center space-x-3 touch-btn">
                        <input type="checkbox" id="fireplace" class="w-5 h-5">
                        <span>Fireplace</span>
                    </label>
                    <label class="flex items-center space-x-3 touch-btn">
                        <input type="checkbox" id="pool" class="w-5 h-5">
                        <span>Pool/Spa</span>
                    </label>
                    <label class="flex items-center space-x-3 touch-btn">
                        <input type="checkbox" id="deck" class="w-5 h-5">
                        <span>Deck/Patio</span>
                    </label>
                    <label class="flex items-center space-x-3 touch-btn">
                        <input type="checkbox" id="garage" class="w-5 h-5">
                        <span>Garage</span>
                    </label>
                    <label class="flex items-center space-x-3 touch-btn">
                        <input type="checkbox" id="basement" class="w-5 h-5">
                        <span>Basement</span>
                    </label>
                </div>
            </div>

            <!-- Other Features -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Other Features</label>
                <input type="text" id="other-features" placeholder="e.g., Hot tub, Generator, Solar panels..." 
                       class="w-full px-3 py-3 border border-gray-300 rounded-lg text-base">
                <p class="text-xs text-gray-500 mt-1">List any additional features not mentioned above</p>
            </div>

            <!-- Helpful Note -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <div class="flex items-start gap-3">
                    <div class="text-blue-600 text-lg">üí°</div>
                    <div class="text-sm text-blue-800">
                        <strong>Good to know:</strong> Task frequencies can be adjusted later based on your specific needs (pets, usage patterns, manufacturer recommendations, etc.)
                    </div>
                </div>
            </div>

            <button onclick="createMaintenancePlan()" class="w-full bg-blue-600 text-white py-4 px-6 rounded-lg hover:bg-blue-700 transition-colors font-medium text-lg touch-btn">
                üöÄ Create My Plan
            </button>
        </div>
    </div>
</div>

        <!-- Task Setup Screen -->
        <div id="task-setup" class="hidden p-4 main-content">
            <div class="bg-white rounded-xl p-6 shadow-lg max-w-4xl mx-auto">
                <div class="text-center mb-6">
                    <div class="text-4xl mb-4">üìã</div>
                    <h2 class="text-xl font-bold text-gray-900 mb-2">Review Your Maintenance Tasks</h2>
                    <p class="text-gray-600 text-sm">We've created a personalized task list organized by category and season.</p>
                </div>
                
                <!-- Property Summary -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="font-semibold text-blue-900">üìç Property Summary</h3>
                        <button onclick="goBackToHomeSetup()" class="bg-blue-600 text-white px-3 py-1 rounded-lg hover:bg-blue-700 text-sm touch-btn">
                            ‚úèÔ∏è Edit Property
                        </button>
                    </div>
                    <div id="task-setup-summary" class="text-sm text-blue-800">
                        <!-- Property summary will go here -->
                    </div>
                </div>

                <!-- Task Summary Stats -->
                <div class="bg-gray-50 p-4 rounded-lg mb-6">
                    <h3 class="font-semibold text-gray-900 mb-3">üìä Task Summary</h3>
                    <div id="task-summary-stats" class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                        <!-- Task stats will be populated here -->
                    </div>
                </div>

                <!-- Add Custom Task Button -->
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-bold text-gray-900">Your Maintenance Schedule</h3>
                    <button onclick="addTaskFromSetup()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 text-sm touch-btn">
                        ‚ûï Add Custom Task
                    </button>
                </div>
                
                <!-- Task Categories -->
                <div id="task-categories" class="space-y-6">
                    <!-- Task categories will be populated here -->
                </div>

                <!-- Navigation Buttons -->
                <div class="flex gap-3 mt-8">
                    <button onclick="goBackToHomeSetup()" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg touch-btn">
                        ‚Üê Back to Home Info
                    </button>
                    <button onclick="finishTaskSetup()" class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 touch-btn">
                        üöÄ Complete Setup
                    </button>
                </div>
            </div>
        </div>

        <!-- Main App (Dashboard & Calendar) -->
        <div id="main-app" class="hidden">
            <div class="main-content">
               <!-- Enhanced Dashboard View -->
<div id="dashboard-view" class="p-4">
    <!-- Welcome -->
    <div class="gradient-bg text-white rounded-2xl p-6 shadow-2xl mb-6">
        <h2 class="text-xl font-bold mb-2">Welcome to Casa Care! üëã</h2>
        <p class="text-blue-100 text-sm" id="home-address">Managing maintenance for your home</p>
    </div>

    <!-- Interactive Stats Grid -->
    <div class="grid grid-cols-2 gap-4 mb-6">
        <div id="overdue-card" class="stat-card bg-white rounded-xl p-4 shadow-lg cursor-pointer hover:shadow-xl transition-all duration-200 hover:scale-105">
            <div class="flex items-center gap-3">
                <div class="p-2 bg-red-100 rounded-lg text-lg">‚ö†Ô∏è</div>
                <div>
                    <p class="text-xs text-gray-600">Overdue</p>
                    <p id="overdue-count" class="text-xl font-bold text-gray-900">0</p>
                </div>
            </div>
            <div class="text-xs text-gray-500 mt-2">Click to view overdue tasks</div>
        </div>
        
        <div id="week-card" class="stat-card bg-white rounded-xl p-4 shadow-lg cursor-pointer hover:shadow-xl transition-all duration-200 hover:scale-105">
            <div class="flex items-center gap-3">
                <div class="p-2 bg-orange-100 rounded-lg text-lg">üìÖ</div>
                <div>
                    <p class="text-xs text-gray-600">This Week</p>
                    <p id="week-count" class="text-xl font-bold text-gray-900">0</p>
                </div>
            </div>
            <div class="text-xs text-gray-500 mt-2">Click to view week's tasks</div>
        </div>
        
        <div id="total-card" class="stat-card bg-white rounded-xl p-4 shadow-lg cursor-pointer hover:shadow-xl transition-all duration-200 hover:scale-105">
            <div class="flex items-center gap-3">
                <div class="p-2 bg-blue-100 rounded-lg text-lg">üìã</div>
                <div>
                    <p class="text-xs text-gray-600">Total Tasks</p>
                    <p id="total-count" class="text-xl font-bold text-gray-900">0</p>
                </div>
            </div>
            <div class="text-xs text-gray-500 mt-2">Click to view all tasks</div>
        </div>
        
        <div id="cost-card" class="stat-card bg-white rounded-xl p-4 shadow-lg cursor-pointer hover:shadow-xl transition-all duration-200 hover:scale-105">
            <div class="flex items-center gap-3">
                <div class="p-2 bg-green-100 rounded-lg text-lg">üí∞</div>
                <div>
                    <p class="text-xs text-gray-600">Annual Cost</p>
                    <p id="annual-cost" class="text-xl font-bold text-gray-900">$0</p>
                </div>
            </div>
            <div class="text-xs text-gray-500 mt-2">Click to sort by cost</div>
        </div>
    </div>

   <!-- Find this section in your HTML and replace the buttons: -->

<!-- Enhanced Tasks Section -->
<div class="bg-white rounded-2xl shadow-lg overflow-hidden">
    <div class="p-4 border-b border-gray-100 flex items-center justify-between">
        <h3 id="tasks-list-title" class="text-lg font-bold text-gray-900">Upcoming Tasks</h3>
        <div class="flex gap-2">
            <!-- REPLACE THIS BUTTON -->
            <button onclick="addTaskFromDashboard()" class="bg-green-100 text-green-700 px-3 py-1 rounded-lg hover:bg-green-200 text-sm touch-btn">
                ‚ûï Add Task
            </button>
            <!-- KEEP THIS BUTTON -->
            <button onclick="exportTaskList()" class="bg-blue-100 text-blue-700 px-3 py-1 rounded-lg hover:bg-blue-200 text-sm touch-btn">
                üìã Export List
            </button>
        </div>
    </div>
    
    <!-- Tasks List -->
    <div id="tasks-list">
        <!-- Enhanced tasks will be populated here -->
    </div>
</div>
</div>

                <!-- Calendar View -->
                <div id="calendar-view" class="hidden">
                    <!-- Calendar will be rendered here by calendar.js -->
                </div>
            </div>

            <!-- Bottom Navigation -->
            <div class="bottom-nav">
                <div class="grid grid-cols-4 gap-1 p-2">
                    <button onclick="showTab('dashboard')" id="tab-dashboard" class="tab-btn flex flex-col items-center p-3 rounded-lg bg-blue-100 text-blue-700 touch-btn">
                        <div class="text-lg mb-1">üè†</div>
                        <div class="text-xs">Home</div>
                    </button>
                    <button onclick="showTab('calendar')" id="tab-calendar" class="tab-btn flex flex-col items-center p-3 rounded-lg text-gray-600 hover:text-gray-900 touch-btn">
                        <div class="text-lg mb-1">üìÖ</div>
                        <div class="text-xs">Calendar</div>
                    </button>
                    <button onclick="clearData()" class="tab-btn flex flex-col items-center p-3 rounded-lg text-gray-600 hover:text-gray-900 touch-btn">
                        <div class="text-lg mb-1">üóëÔ∏è</div>
                        <div class="text-xs">Reset</div>
                    </button>
                    <button onclick="exportData()" class="tab-btn flex flex-col items-center p-3 rounded-lg text-gray-600 hover:text-gray-900 touch-btn">
                        <div class="text-lg mb-1">üìÑ</div>
                        <div class="text-xs">Export</div>
                    </button>
                </div>
            </div>
        </div>

        <!-- UPDATED Task Edit Modal - Replace the existing one in your HTML -->
<div id="task-edit-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl w-full max-w-md p-6 max-h-[90vh] overflow-y-auto">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-xl font-bold" id="task-edit-title">Edit Task</h3>
            <button onclick="closeTaskEditModal()" class="text-gray-500 hover:text-gray-700 text-xl">√ó</button>
        </div>
        
        <div class="space-y-4">
            <!-- Task Name -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Task Name *</label>
                <input type="text" id="edit-task-name" 
                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-base"
                       placeholder="Enter task name" required>
            </div>
            
            <!-- Description -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Description *</label>
                <textarea id="edit-task-description" 
                          class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-base" 
                          rows="3" placeholder="Describe what needs to be done" required></textarea>
            </div>
            
            <!-- Due Date -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Due Date *</label>
                <input type="date" id="edit-task-due-date" 
                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-base" required>
            </div>
            
            <!-- Frequency and Cost Row -->
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Frequency (days) *</label>
                    <input type="number" id="edit-task-frequency" 
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-base"
                           min="1" placeholder="365" required>
                    <p class="text-xs text-gray-500 mt-1">How often to repeat</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Cost ($)</label>
                    <input type="number" id="edit-task-cost" 
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-base"
                           min="0" step="0.01" placeholder="0.00">
                </div>
            </div>
            
            <!-- Priority -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Priority *</label>
                <select id="edit-task-priority" 
                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-base" required>
                    <option value="high">üî¥ High Priority</option>
                    <option value="medium">üü° Medium Priority</option>
                    <option value="low">üü¢ Low Priority</option>
                </select>
            </div>
            
            <!-- Category (optional - could be added) -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                <select id="edit-task-category" 
                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-base">
                    <option value="General">üîß General</option>
                    <option value="HVAC">üå°Ô∏è HVAC</option>
                    <option value="Water Systems">üíß Water Systems</option>
                    <option value="Exterior">üè† Exterior</option>
                    <option value="Safety">‚ö†Ô∏è Safety</option>
                    <option value="Seasonal">üåç Seasonal</option>
                </select>
            </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="flex gap-3 mt-6">
            <button onclick="deleteTaskFromEdit()" 
                    class="bg-red-600 text-white px-4 py-3 rounded-lg hover:bg-red-700 transition-colors touch-btn">
                üóëÔ∏è Delete
            </button>
            <button onclick="closeTaskEditModal()" 
                    class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg hover:bg-gray-300 transition-colors touch-btn">
                Cancel
            </button>
            <button onclick="saveTaskFromEdit()" 
                    class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors touch-btn">
                üíæ Save Task
            </button>
        </div>
        
        <!-- Helper Text -->
        <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
            <p class="text-xs text-blue-800">
                <strong>üí° Tip:</strong> Frequency determines how often this task repeats after completion. 
                For example, 90 days means the task will be due again 90 days after you mark it complete.
            </p>
        </div>
    </div>
</div>
<div id="date-picker-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl w-full max-w-sm p-6 shadow-2xl">
        <div class="text-center mb-6">
            <h3 class="text-xl font-bold text-gray-900 mb-2">üìÖ Reschedule Task</h3>
            <p id="reschedule-task-name" class="text-gray-600 text-sm"></p>
        </div>

        <div class="space-y-4">
            <!-- Current Due Date -->
            <div class="bg-gray-50 rounded-lg p-3">
                <label class="block text-sm font-medium text-gray-700 mb-1">Current Due Date</label>
                <p id="current-due-date" class="text-gray-900 font-semibold"></p>
            </div>

            <!-- New Due Date -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">New Due Date</label>
                <input type="date" id="new-due-date" 
                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-base">
            </div>

            <!-- Quick Options -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Quick Options</label>
                <div class="grid grid-cols-2 gap-2">
                    <button type="button" onclick="setQuickDate(1)" 
                            class="bg-blue-100 text-blue-700 px-3 py-2 rounded-lg hover:bg-blue-200 text-sm touch-btn">
                        Tomorrow
                    </button>
                    <button type="button" onclick="setQuickDate(7)" 
                            class="bg-green-100 text-green-700 px-3 py-2 rounded-lg hover:bg-green-200 text-sm touch-btn">
                        Next Week
                    </button>
                    <button type="button" onclick="setQuickDate(30)" 
                            class="bg-yellow-100 text-yellow-700 px-3 py-2 rounded-lg hover:bg-yellow-200 text-sm touch-btn">
                        Next Month
                    </button>
                    <button type="button" onclick="setQuickDate(90)" 
                            class="bg-purple-100 text-purple-700 px-3 py-2 rounded-lg hover:bg-purple-200 text-sm touch-btn">
                        3 Months
                    </button>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex gap-3 mt-6">
            <button onclick="closeDatePickerModal()" 
                    class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg hover:bg-gray-300 touch-btn">
                Cancel
            </button>
            <button onclick="confirmReschedule()" 
                    class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 touch-btn">
                üìÖ Reschedule
            </button>
        </div>
    </div>
</div>
    </div>

    <script src="app.js"></script>
    <script src="calendar.js"></script>
    <script src="enhanced-dashboard.js"></script>
 <script src="app.js"></script>
    <script src="calendar.js"></script>
    <script src="enhanced-dashboard.js"></script>
    <!-- Calendar Compatibility Fix -->
<script>
   // Calendar Compatibility Fix for Casa Care
// This ensures calendar integration works with the new dueDate field

// ENHANCED: Ensure compatibility on all data operations
function ensureCalendarCompatibility() {
    if (!window.tasks) return;
    
    window.tasks.forEach(task => {
        // Ensure dueDate exists and is a Date object
        if (task.dueDate && !(task.dueDate instanceof Date)) {
            task.dueDate = new Date(task.dueDate);
        }
        
        // For backward compatibility, provide nextDue as alias to dueDate
        if (task.dueDate && !task.hasOwnProperty('nextDue')) {
            Object.defineProperty(task, 'nextDue', {
                get: function() { return this.dueDate; },
                set: function(value) { 
                    this.dueDate = value instanceof Date ? value : new Date(value);
                },
                enumerable: true,
                configurable: true
            });
        }
        
        // If we have old nextDue but no dueDate, migrate it
        if (task.nextDue && !task.dueDate) {
            task.dueDate = task.nextDue instanceof Date ? task.nextDue : new Date(task.nextDue);
        }
    });
    
    console.log(`üìÖ Calendar compatibility ensured for ${window.tasks.length} tasks`);
}

// Run compatibility check when DOM loads
document.addEventListener('DOMContentLoaded', function() {
    // Wait for other scripts to load
    setTimeout(function() {
        ensureCalendarCompatibility();
        console.log('üìÖ Calendar compatibility layer initialized');
    }, 200);
});

// Also run when window loads (backup)
window.addEventListener('load', function() {
    setTimeout(ensureCalendarCompatibility, 100);
});

// Enhanced task getter for calendar integration
function getTasksForCalendar() {
    if (!window.tasks) return [];
    
    // Ensure compatibility before returning
    ensureCalendarCompatibility();
    
    // Return tasks with both dueDate and nextDue for compatibility
    return window.tasks.map(task => ({
        ...task,
        nextDue: task.dueDate, // Ensure calendar gets the due date
        dueDate: task.dueDate  // Ensure both are available
    }));
}

// Override the original saveData function to ensure compatibility
const originalSaveData = window.saveData;
if (originalSaveData) {
    window.saveData = function() {
        // Ensure compatibility before saving
        ensureCalendarCompatibility();
        
        // Call original save function
        return originalSaveData.apply(this, arguments);
    };
}

// Override the original loadData function to ensure compatibility
const originalLoadData = window.loadData;
if (originalLoadData) {
    window.loadData = function() {
        // Call original load function
        const result = originalLoadData.apply(this, arguments);
        
        // Ensure compatibility after loading
        if (result) {
            ensureCalendarCompatibility();
        }
        
        return result;
    };
}

// Make functions globally available
window.getTasksForCalendar = getTasksForCalendar;
window.ensureCalendarCompatibility = ensureCalendarCompatibility;

console.log('üìÖ Enhanced calendar compatibility fix loaded'); </script>
  <!-- Add this script AFTER all your other scripts to ensure functions are loaded -->
<script>
// Function Loader and Debug Script for Casa Care
// This ensures all dashboard functions are properly available

document.addEventListener('DOMContentLoaded', function() {
    // Wait for all scripts to load
    setTimeout(function() {
        console.log('üîç Checking function availability...');
        
        // FORCE CHECK: Look for prompt-based functions and warn
        const dashboardFunctions = ['addTaskFromDashboard', 'editTaskFromDashboard'];
        dashboardFunctions.forEach(funcName => {
            if (typeof window[funcName] === 'function') {
                const funcStr = window[funcName].toString();
                if (funcStr.includes('prompt(')) {
                    console.warn(`‚ö†Ô∏è ${funcName} still uses prompts! This should use modal instead.`);
                    console.log('üîß Function source:', funcStr.substring(0, 200) + '...');
                }
            }
        });
        
        // Check critical functions
        const requiredFunctions = [
            'editTaskFromDashboard',
            'addTaskFromDashboard',
            'rescheduleTaskFromDashboard',
            'closeTaskEditModal',
            'saveTaskFromEdit',
            'deleteTaskFromEdit',
            'closeDatePickerModal',
            'setQuickDate',
            'confirmReschedule'
        ];
        
        let missingFunctions = [];
        requiredFunctions.forEach(funcName => {
            if (typeof window[funcName] !== 'function') {
                missingFunctions.push(funcName);
            }
        });
        
        if (missingFunctions.length > 0) {
            console.error('‚ùå Missing functions:', missingFunctions);
            console.log('üîß Attempting to load functions...');
            
            // Try to reload enhanced dashboard if available
            if (typeof EnhancedDashboard !== 'undefined' && !window.enhancedDashboard) {
                try {
                    window.enhancedDashboard = new EnhancedDashboard();
                    console.log('‚úÖ Enhanced dashboard reloaded');
                } catch (error) {
                    console.error('‚ùå Failed to reload enhanced dashboard:', error);
                }
            }
        } else {
            console.log('‚úÖ All dashboard functions loaded successfully');
        }
        
        // Check modal elements
        const requiredModals = ['task-edit-modal', 'date-picker-modal'];
        let missingModals = [];
        requiredModals.forEach(modalId => {
            if (!document.getElementById(modalId)) {
                missingModals.push(modalId);
            }
        });
        
        if (missingModals.length > 0) {
            console.error('‚ùå Missing modal elements:', missingModals);
            console.log('üí° Make sure you have updated your HTML with the new task edit modal');
        } else {
            console.log('‚úÖ All modal elements found');
        }
        
        // CRITICAL: Test actual button clicks
        console.log('üß™ Testing button functionality...');
        const addButton = document.querySelector('[onclick="addTaskFromDashboard()"]');
        const editButtons = document.querySelectorAll('[onclick^="editTaskFromDashboard("]');
        
        console.log(`üìä Found ${addButton ? 1 : 0} Add Task button(s)`);
        console.log(`üìä Found ${editButtons.length} Edit Task button(s)`);
        
        // Add debug function to window
        window.debugCasaCare = function() {
            console.log('=== CASA CARE DEBUG ===');
            console.log('Functions available:', requiredFunctions.filter(f => typeof window[f] === 'function').length + '/' + requiredFunctions.length);
            console.log('Modal elements found:', requiredModals.filter(m => document.getElementById(m)).length + '/' + requiredModals.length);
            console.log('Enhanced dashboard:', window.enhancedDashboard ? '‚úÖ' : '‚ùå');
            console.log('Tasks loaded:', window.tasks ? window.tasks.length : 'none');
            console.log('Current editing task:', window.currentEditingTask ? '‚úÖ' : '‚ùå');
            
            // Test function sources
            console.log('\nüîç FUNCTION SOURCES:');
            dashboardFunctions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    const funcStr = window[funcName].toString();
                    const usesPrompt = funcStr.includes('prompt(');
                    const usesModal = funcStr.includes('task-edit-modal') || funcStr.includes('modal.classList');
                    console.log(`  ${funcName}: ${usesModal ? '‚úÖ MODAL' : usesPrompt ? '‚ùå PROMPT' : '‚ùì UNKNOWN'}`);
                }
            });
            
            if (typeof window.debugDashboardFunctions === 'function') {
                window.debugDashboardFunctions();
            }
        };
        
        // FORCE REFRESH: If enhanced dashboard exists, make sure it's initialized
        if (typeof EnhancedDashboard !== 'undefined' && !window.enhancedDashboard) {
            console.log('üîÑ Force initializing enhanced dashboard...');
            try {
                window.enhancedDashboard = new EnhancedDashboard();
            } catch (error) {
                console.error('‚ùå Failed to force init enhanced dashboard:', error);
            }
        }
        
        console.log('üéØ Casa Care function loader complete. Run debugCasaCare() for detailed info.');
        
    }, 1000); // Wait 1 second for all scripts to load completely
});
</script>
    <!-- MODAL FUNCTION OVERRIDE SCRIPT - Add this LAST, after ALL other scripts -->
<script>
// DEFINITIVE MODAL FUNCTION OVERRIDE
// This script FORCES the modal-based functions to be used instead of prompt-based ones

console.log('üîß MODAL OVERRIDE: Force loading modal-based functions...');

// FORCE OVERRIDE: Dashboard Add Task (NO PROMPTS!)
window.addTaskFromDashboard = function() {
    console.log('‚ûï MODAL VERSION: Adding new task from dashboard...');
    
    // Find next available ID
    const maxId = Math.max(...window.tasks.map(t => t.id), 0);
    
    // Create new task object
    const newTask = {
        id: maxId + 1,
        title: '',
        description: '',
        category: 'General',
        frequency: 365,
        cost: 0,
        priority: 'medium',
        dueDate: new Date(),
        lastCompleted: null,
        isCompleted: false
    };
    
    // CRITICAL: Set as current editing task
    window.currentEditingTask = newTask;
    console.log('‚úÖ Current editing task set:', newTask);
    
    // Open modal directly
    const modal = document.getElementById('task-edit-modal');
    if (modal) {
        console.log('‚úÖ Opening task modal for dashboard add');
        
        // Fill modal fields for new task
        document.getElementById('edit-task-name').value = '';
        document.getElementById('edit-task-description').value = '';
        document.getElementById('edit-task-cost').value = 0;
        document.getElementById('edit-task-frequency').value = 365;
        document.getElementById('edit-task-priority').value = 'medium';
        
        // Handle category if field exists
        const categoryField = document.getElementById('edit-task-category');
        if (categoryField) {
            categoryField.value = 'General';
        }
        
        // Handle due date
        const dueDateInput = document.getElementById('edit-task-due-date');
        if (dueDateInput) {
            dueDateInput.value = new Date().toISOString().split('T')[0];
        }
        
        // Update modal title
        const modalTitle = document.getElementById('task-edit-title');
        if (modalTitle) {
            modalTitle.textContent = 'Add New Task';
        }
        
        // Hide delete button for new task
        const deleteButton = modal.querySelector('[onclick="deleteTaskFromEdit()"]');
        if (deleteButton) {
            deleteButton.style.display = 'none';
        }
        
        // Show modal
        modal.classList.remove('hidden');
        
        // Focus on task name
        setTimeout(() => document.getElementById('edit-task-name').focus(), 100);
        
        console.log('‚úÖ MODAL VERSION: Add task modal opened');
    } else {
        console.error('‚ùå Task edit modal not found');
        alert('‚ùå Task edit modal not found. Please check your HTML.');
    }
};

// FORCE OVERRIDE: Dashboard Edit Task (NO PROMPTS!)
window.editTaskFromDashboard = function(taskId) {
    console.log('‚úèÔ∏è MODAL VERSION: Editing task from dashboard:', taskId);
    
    const task = window.tasks.find(t => t.id === taskId);
    if (!task) {
        console.error('‚ùå Task not found:', taskId);
        alert('‚ùå Task not found');
        return;
    }

    // CRITICAL: Set as current editing task
    window.currentEditingTask = task;
    console.log('‚úÖ Current editing task set:', task);

    // Open modal directly
    const modal = document.getElementById('task-edit-modal');
    if (modal) {
        console.log('‚úÖ Opening task modal for dashboard edit');
        
        // Fill modal fields
        document.getElementById('edit-task-name').value = task.title || '';
        document.getElementById('edit-task-description').value = task.description || '';
        document.getElementById('edit-task-cost').value = task.cost || 0;
        document.getElementById('edit-task-frequency').value = task.frequency || 365;
        document.getElementById('edit-task-priority').value = task.priority || 'medium';
        
        // Handle category if field exists
        const categoryField = document.getElementById('edit-task-category');
        if (categoryField) {
            categoryField.value = task.category || 'General';
        }
        
        // Handle due date
        const dueDateInput = document.getElementById('edit-task-due-date');
        if (dueDateInput) {
            if (task.dueDate) {
                const dueDate = task.dueDate instanceof Date ? task.dueDate : new Date(task.dueDate);
                dueDateInput.value = dueDate.toISOString().split('T')[0];
            } else {
                dueDateInput.value = new Date().toISOString().split('T')[0];
            }
        }
        
        // Update modal title
        const modalTitle = document.getElementById('task-edit-title');
        if (modalTitle) {
            modalTitle.textContent = 'Edit Task';
        }
        
        // Show delete button
        const deleteButton = modal.querySelector('[onclick="deleteTaskFromEdit()"]');
        if (deleteButton) {
            deleteButton.style.display = 'block';
        }
        
        // Show modal
        modal.classList.remove('hidden');
        
        // Focus on task name
        setTimeout(() => document.getElementById('edit-task-name').focus(), 100);
        
        console.log('‚úÖ MODAL VERSION: Edit task modal opened');
    } else {
        console.error('‚ùå Task edit modal not found');
        alert('‚ùå Task edit modal not found. Please check your HTML.');
    }
};

// FORCE OVERRIDE: Save Task Function
window.saveTaskFromEdit = function() {
    console.log('üíæ MODAL VERSION: Saving task from edit modal...');
    
    if (!window.currentEditingTask) {
        console.error('‚ùå No task being edited');
        alert('‚ùå No task selected for editing');
        return;
    }
    
    // Get form values
    const title = document.getElementById('edit-task-name').value.trim();
    const description = document.getElementById('edit-task-description').value.trim();
    const cost = parseFloat(document.getElementById('edit-task-cost').value) || 0;
    const frequency = parseInt(document.getElementById('edit-task-frequency').value) || 365;
    const priority = document.getElementById('edit-task-priority').value;
    const category = document.getElementById('edit-task-category')?.value || 'General';
    const dueDateInput = document.getElementById('edit-task-due-date');
    
    console.log('üìù Form values:', { title, description, cost, frequency, priority, category });
    
    // Validate inputs
    if (!title) {
        alert('‚ùå Task name is required');
        document.getElementById('edit-task-name').focus();
        return;
    }
    
    if (!description) {
        alert('‚ùå Task description is required');
        document.getElementById('edit-task-description').focus();
        return;
    }
    
    if (frequency <= 0) {
        alert('‚ùå Frequency must be greater than 0');
        document.getElementById('edit-task-frequency').focus();
        return;
    }
    
    // Handle due date
    let dueDate;
    if (dueDateInput && dueDateInput.value) {
        dueDate = new Date(dueDateInput.value + 'T12:00:00');
        if (isNaN(dueDate.getTime())) {
            alert('‚ùå Invalid due date');
            dueDateInput.focus();
            return;
        }
    } else {
        dueDate = new Date();
    }
    
    // Check if this is a new task
    const isNewTask = !window.tasks.find(t => t.id === window.currentEditingTask.id);
    console.log('üÜï Is new task:', isNewTask);
    
    // Update task properties
    window.currentEditingTask.title = title;
    window.currentEditingTask.description = description;
    window.currentEditingTask.cost = cost;
    window.currentEditingTask.frequency = frequency;
    window.currentEditingTask.priority = priority;
    window.currentEditingTask.category = category;
    window.currentEditingTask.dueDate = dueDate;
    window.currentEditingTask.nextDue = dueDate; // Calendar compatibility
    
    if (isNewTask) {
        // Add to tasks array
        window.tasks.push(window.currentEditingTask);
        console.log('‚úÖ New task added to global array');
    } else {
        console.log('‚úÖ Existing task updated');
    }
    
    // Save and refresh
    try {
        // Save data
        if (typeof window.saveData === 'function') {
            window.saveData();
        } else if (typeof saveData === 'function') {
            saveData();
        }
        console.log('üíæ Data saved');
        
        // Refresh dashboard
        if (window.enhancedDashboard && typeof window.enhancedDashboard.render === 'function') {
            window.enhancedDashboard.render();
            console.log('üîÑ Enhanced dashboard refreshed');
        } else if (typeof updateDashboard === 'function') {
            updateDashboard();
            console.log('üîÑ Basic dashboard updated');
        }
        
        // Refresh calendar if available
        if (window.casaCareCalendar && typeof window.casaCareCalendar.refresh === 'function') {
            window.casaCareCalendar.refresh();
            console.log('üìÖ Calendar refreshed');
        }
        
        // Also try to refresh task categories if in setup
        if (typeof renderTaskCategories === 'function') {
            const taskSetup = document.getElementById('task-setup');
            if (taskSetup && !taskSetup.classList.contains('hidden')) {
                renderTaskCategories();
                console.log('üìã Task categories re-rendered');
            }
        }
        
    } catch (error) {
        console.error('‚ùå Error during save/refresh:', error);
    }
    
    // Close modal
    window.closeTaskEditModal();
    
    alert(`‚úÖ Task "${title}" ${isNewTask ? 'added' : 'updated'} successfully!`);
};

// FORCE OVERRIDE: Close Modal Function
window.closeTaskEditModal = function() {
    const modal = document.getElementById('task-edit-modal');
    if (modal) {
        modal.classList.add('hidden');
    }
    window.currentEditingTask = null;
    console.log('‚úÖ MODAL VERSION: Task edit modal closed');
};

// FORCE OVERRIDE: Delete Task Function
window.deleteTaskFromEdit = function() {
    if (!window.currentEditingTask) {
        console.error('‚ùå No task being edited');
        return;
    }
    
    if (confirm(`Are you sure you want to delete "${window.currentEditingTask.title}"?`)) {
        const taskIndex = window.tasks.findIndex(t => t.id === window.currentEditingTask.id);
        if (taskIndex > -1) {
            const deletedTask = window.tasks.splice(taskIndex, 1)[0];
            console.log(`üóëÔ∏è Deleted task: ${deletedTask.title}`);
            
            // Save data
            if (typeof window.saveData === 'function') {
                window.saveData();
            } else if (typeof saveData === 'function') {
                saveData();
            }
            
            // Refresh dashboard
            if (window.enhancedDashboard) {
                window.enhancedDashboard.render();
            }
            
            // Refresh calendar if it exists
            if (window.casaCareCalendar && typeof window.casaCareCalendar.refresh === 'function') {
                window.casaCareCalendar.refresh();
            }
            
            // Also refresh task categories if in setup
            if (typeof renderTaskCategories === 'function') {
                const taskSetup = document.getElementById('task-setup');
                if (taskSetup && !taskSetup.classList.contains('hidden')) {
                    renderTaskCategories();
                }
            }
            
            // Close modal
            window.closeTaskEditModal();
            
            alert(`‚úÖ Task "${deletedTask.title}" deleted successfully!`);
        }
    }
};

// FORCE OVERRIDE: Reschedule function to use date picker modal
window.rescheduleTaskFromDashboard = function(taskId) {
    console.log('üìÖ MODAL VERSION: Rescheduling task:', taskId);
    
    const task = window.tasks.find(t => t.id === taskId);
    if (!task) {
        console.error('‚ùå Task not found:', taskId);
        return;
    }

    // Store the task for the date picker modal
    window.currentRescheduleTask = task;
    
    // Try to use the date picker modal
    const datePickerModal = document.getElementById('date-picker-modal');
    const taskNameElement = document.getElementById('reschedule-task-name');
    const currentDueDateElement = document.getElementById('current-due-date');
    const newDueDateInput = document.getElementById('new-due-date');
    
    if (datePickerModal && taskNameElement && currentDueDateElement && newDueDateInput) {
        console.log('‚úÖ Using date picker modal');
        
        // Set task info
        taskNameElement.textContent = `"${task.title}"`;
        
        // Set current due date
        const currentDate = task.dueDate instanceof Date ? task.dueDate : new Date(task.dueDate);
        currentDueDateElement.textContent = currentDate.toLocaleDateString('en-US', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
        
        // Set default new date to current due date
        newDueDateInput.value = currentDate.toISOString().split('T')[0];
        
        // Show modal
        datePickerModal.classList.remove('hidden');
        
        // Focus on date input
        setTimeout(() => newDueDateInput.focus(), 100);
        
        console.log(`üìÖ MODAL VERSION: Date picker opened for task: ${task.title}`);
    } else {
        console.warn('‚ö†Ô∏è Date picker modal elements not found');
        alert('‚ùå Date picker modal not available. Please check your HTML.');
    }
};

// Override confirmReschedule to work with our system
window.confirmReschedule = function() {
    if (!window.currentRescheduleTask) {
        console.error('‚ùå No task selected for rescheduling');
        return;
    }
    
    const newDueDateInput = document.getElementById('new-due-date');
    if (!newDueDateInput || !newDueDateInput.value) {
        alert('‚ùå Please select a new due date');
        return;
    }
    
    const newDate = new Date(newDueDateInput.value + 'T12:00:00');
    if (isNaN(newDate.getTime())) {
        alert('‚ùå Invalid date selected');
        return;
    }
    
    // Update the task
    const oldDate = window.currentRescheduleTask.dueDate instanceof Date ? 
        window.currentRescheduleTask.dueDate : new Date(window.currentRescheduleTask.dueDate);
    
    window.currentRescheduleTask.dueDate = newDate;
    window.currentRescheduleTask.nextDue = newDate;
    
    // Save data
    if (typeof window.saveData === 'function') {
        window.saveData();
    } else if (typeof saveData === 'function') {
        saveData();
    }
    
    // Refresh everything
    if (window.enhancedDashboard) {
        window.enhancedDashboard.render();
    }
    
    if (window.casaCareCalendar && typeof window.casaCareCalendar.refresh === 'function') {
        window.casaCareCalendar.refresh();
    }
    
    // Close modal
    window.closeDatePickerModal();
    
    console.log(`‚úÖ Task rescheduled from ${oldDate.toLocaleDateString()} to ${newDate.toLocaleDateString()}`);
    alert(`‚úÖ Task rescheduled to ${newDate.toLocaleDateString()}`);
};

// Override closeDatePickerModal
window.closeDatePickerModal = function() {
    const modal = document.getElementById('date-picker-modal');
    if (modal) {
        modal.classList.add('hidden');
    }
    window.currentRescheduleTask = null;
    console.log('üìÖ Date picker modal closed');
};

// Override setQuickDate
window.setQuickDate = function(daysFromNow) {
    const newDueDateInput = document.getElementById('new-due-date');
    if (!newDueDateInput) return;
    
    const newDate = new Date();
    newDate.setDate(newDate.getDate() + daysFromNow);
    
    newDueDateInput.value = newDate.toISOString().split('T')[0];
    
    // Add visual feedback
    newDueDateInput.style.backgroundColor = '#dbeafe';
    setTimeout(() => {
        newDueDateInput.style.backgroundColor = '';
    }, 300);
    
    console.log(`üìÖ Quick date set to ${daysFromNow} days from now`);
};

console.log('‚úÖ MODAL OVERRIDE: All functions have been force-overridden to use modals!');

// Test function to verify override
window.testModalOverride = function() {
    console.log('üß™ TESTING MODAL OVERRIDE:');
    const functions = ['addTaskFromDashboard', 'editTaskFromDashboard', 'rescheduleTaskFromDashboard'];
    functions.forEach(funcName => {
        const func = window[funcName];
        if (func) {
            const funcStr = func.toString();
            const usesPrompt = funcStr.includes('prompt(');
            const usesModal = funcStr.includes('task-edit-modal') || funcStr.includes('modal.classList');
            console.log(`  ${funcName}: ${usesModal ? '‚úÖ MODAL' : usesPrompt ? '‚ùå PROMPT' : '‚ùì UNKNOWN'}`);
        }
    });
};

console.log('üí° Run testModalOverride() to verify all functions use modals now');
</script>
    <!-- MODAL DIAGNOSTIC SCRIPT - Add temporarily to test what's happening -->
<script>
// DIAGNOSTIC: Test modal functionality step by step
window.testModalStep = function(step) {
    console.log(`üß™ TESTING STEP ${step}:`);
    
    switch(step) {
        case 1:
            console.log('Step 1: Testing modal element existence');
            const modal = document.getElementById('task-edit-modal');
            console.log('Modal element:', modal ? '‚úÖ Found' : '‚ùå Not Found');
            if (modal) {
                console.log('Modal classes:', modal.className);
                console.log('Modal style display:', modal.style.display);
                console.log('Modal hidden class:', modal.classList.contains('hidden'));
            }
            break;
            
        case 2:
            console.log('Step 2: Testing modal form fields');
            const fields = [
                'edit-task-name',
                'edit-task-description', 
                'edit-task-cost',
                'edit-task-frequency',
                'edit-task-priority',
                'edit-task-due-date',
                'edit-task-category'
            ];
            
            fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                console.log(`  ${fieldId}: ${field ? '‚úÖ' : '‚ùå'}`);
                if (field) {
                    console.log(`    Type: ${field.type || field.tagName}`);
                }
            });
            break;
            
        case 3:
            console.log('Step 3: Testing Add Task function manually');
            try {
                // Test the function directly
                if (typeof window.addTaskFromDashboard === 'function') {
                    console.log('‚úÖ Function exists, calling it...');
                    window.addTaskFromDashboard();
                    console.log('‚úÖ Function completed without errors');
                } else {
                    console.log('‚ùå Function does not exist');
                }
            } catch (error) {
                console.error('‚ùå Function threw error:', error);
            }
            break;
            
        case 4:
            console.log('Step 4: Testing manual modal opening');
            const modal4 = document.getElementById('task-edit-modal');
            if (modal4) {
                console.log('‚úÖ Opening modal manually...');
                modal4.classList.remove('hidden');
                console.log('Modal should now be visible');
                
                // Test if fields can be filled
                setTimeout(() => {
                    try {
                        document.getElementById('edit-task-name').value = 'Test Task';
                        document.getElementById('edit-task-description').value = 'Test Description';
                        console.log('‚úÖ Fields filled successfully');
                    } catch (error) {
                        console.error('‚ùå Error filling fields:', error);
                    }
                }, 100);
            }
            break;
            
        case 5:
            console.log('Step 5: Testing button click events');
            // Find Add Task button
            const addButton = document.querySelector('[onclick="addTaskFromDashboard()"]');
            console.log('Add Task button found:', addButton ? '‚úÖ' : '‚ùå');
            if (addButton) {
                console.log('Button onclick:', addButton.getAttribute('onclick'));
                console.log('Button text:', addButton.textContent.trim());
            }
            
            // Find Edit buttons
            const editButtons = document.querySelectorAll('[onclick^="editTaskFromDashboard("]');
            console.log('Edit Task buttons found:', editButtons.length);
            editButtons.forEach((btn, i) => {
                console.log(`  Edit button ${i+1}:`, btn.getAttribute('onclick'));
            });
            break;
            
        case 6:
            console.log('Step 6: Testing currentEditingTask variable');
            console.log('window.currentEditingTask:', window.currentEditingTask);
            console.log('Setting test task...');
            window.currentEditingTask = { id: 999, title: 'Test', description: 'Test' };
            console.log('Test task set:', window.currentEditingTask);
            break;
    }
};

// Run all tests automatically
window.runAllModalTests = function() {
    console.log('üß™ RUNNING ALL MODAL DIAGNOSTIC TESTS...');
    for (let i = 1; i <= 6; i++) {
        window.testModalStep(i);
        console.log(''); // Empty line for readability
    }
};

console.log('üß™ Modal diagnostic loaded. Run:');
console.log('  testModalStep(1) through testModalStep(6) for individual tests');
console.log('  runAllModalTests() for all tests at once');
</script>
   
</body>
</html>
</body>
</html>
