<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Casa Care - Smart Home Maintenance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg { 
            background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%); 
        }
        .fade-in { 
            animation: fadeIn 0.5s ease-in-out; 
        }
        .slide-up { 
            animation: slideUp 0.3s ease-out; 
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .step-indicator {
            transition: all 0.3s ease;
        }
        
        .step-active {
            background: linear-gradient(135deg, #0891b2, #06b6d4);
            color: white;
        }
        
        .step-completed {
            background: #10b981;
            color: white;
        }

        .address-suggestion {
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .address-suggestion:hover {
            background-color: #f3f4f6;
        }

        .system-card {
            transition: all 0.2s ease;
        }

        .system-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .system-card.selected {
            border-color: #0891b2;
            background-color: #ecfeff;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="app">
        <!-- Header -->
        <div class="bg-white shadow-sm border-b">
            <div class="max-w-4xl mx-auto px-4 py-4">
                <h1 class="text-2xl font-bold text-gray-900">Casa Care</h1>
                <p class="text-gray-600">Smart home maintenance, personalized for your property</p>
            </div>
        </div>

        <!-- API Setup Screen -->
        <div id="api-setup" class="max-w-2xl mx-auto px-4 py-8">
            <div class="bg-white rounded-xl p-8 shadow-lg">
                <div class="text-center mb-8">
                    <div class="text-4xl mb-4">üîë</div>
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">Enhanced Property Lookup</h2>
                    <p class="text-gray-600">Get real property data or use our smart demo mode</p>
                </div>
                
                <div class="space-y-6">
                    <div class="bg-blue-50 rounded-lg p-6">
                        <h3 class="font-semibold text-blue-900 mb-3">üöÄ Option 1: Real Property Data (Recommended)</h3>
                        <div class="text-sm text-blue-800 space-y-2">
                            <p><strong>Google Places API:</strong> Get real address autocomplete and property details</p>
                            <ol class="ml-4 space-y-1">
                                <li>1. Go to <a href="https://console.cloud.google.com/google/maps-apis/overview" target="_blank" class="underline hover:text-blue-600">Google Cloud Console</a></li>
                                <li>2. Enable "Places API" (free $200 credit)</li>
                                <li>3. Create an API key</li>
                                <li>4. Paste it below</li>
                            </ol>
                            <p class="text-xs text-blue-600 mt-3">üí° About $0.02 per address lookup - very affordable!</p>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Google Places API Key (Optional)</label>
                        <input type="text" id="api-key-input" placeholder="AIza..." 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <p class="text-xs text-gray-500 mt-1">Stored locally on your device only</p>
                    </div>
                    
                    <div class="flex gap-4">
                        <button onclick="saveApiKey()" class="flex-1 bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors font-medium">
                            Use Real Data
                        </button>
                        <button onclick="useDemoMode()" class="flex-1 bg-green-600 text-white py-3 px-6 rounded-lg hover:bg-green-700 transition-colors font-medium">
                            Use Smart Demo
                        </button>
                    </div>
                    
                    <div class="bg-green-50 rounded-lg p-4">
                        <h4 class="font-medium text-green-900 mb-2">‚ú® Smart Demo Mode</h4>
                        <p class="text-sm text-green-800">Uses intelligent property simulation based on location patterns. Perfect for testing and family use!</p>
                    </div>
            <!-- Calendar Tab -->
            <div id="app-calendar" class="app-content hidden max-w-6xl mx-auto px-4 pb-8">
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                    <div class="p-6 border-b border-gray-100 flex items-center justify-between">
                        <div>
                            <h3 class="text-xl font-bold text-gray-900">Maintenance Schedule</h3>
                            <p class="text-gray-600">Export to your calendar or view upcoming tasks</p>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="exportCalendar()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                üìÖ Export Calendar
                            </button>
                            <button onclick="exportICS()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                                üì± Download .ics
                            </button>
                        </div>
                    </div>
                    <div class="p-6">
                        <div id="calendar-view" class="space-y-6">
                            <!-- Calendar view will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Setup Wizard -->
        <div id="setup-wizard" class="max-w-2xl mx-auto px-4 py-8 hidden">
            <!-- Progress Indicators -->
            <div class="flex items-center justify-between mb-8">
                <div class="flex items-center space-x-4">
                    <div id="step-1" class="step-indicator step-active w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold">1</div>
                    <div class="w-12 h-1 bg-gray-200" id="progress-1"></div>
                    <div id="step-2" class="step-indicator w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-sm font-bold text-gray-500">2</div>
                    <div class="w-12 h-1 bg-gray-200" id="progress-2"></div>
                    <div id="step-3" class="step-indicator w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-sm font-bold text-gray-500">3</div>
                    <div class="w-12 h-1 bg-gray-200" id="progress-3"></div>
                    <div id="step-4" class="step-indicator w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-sm font-bold text-gray-500">4</div>
                    <div class="w-12 h-1 bg-gray-200" id="progress-4"></div>
                    <div id="step-5" class="step-indicator w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-sm font-bold text-gray-500">5</div>
                </div>
            </div>

            <!-- Step 1: Address Input -->
            <div id="wizard-step-1" class="wizard-step bg-white rounded-xl p-8 shadow-lg slide-up">
                <div class="text-center mb-8">
                    <div class="text-4xl mb-4">üè†</div>
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">What's your address?</h2>
                    <p class="text-gray-600">We'll look up your property details automatically</p>
                </div>
                
                <div class="space-y-4">
                    <div class="relative">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Home Address</label>
                        <input type="text" id="address-input" placeholder="Start typing your address..." 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg"
                               oninput="searchAddresses(this.value)"
                               autocomplete="off">
                        
                        <!-- Address suggestions dropdown -->
                        <div id="address-suggestions" class="absolute z-10 w-full bg-white border border-gray-300 rounded-lg shadow-lg mt-1 hidden max-h-60 overflow-y-auto">
                            <!-- Suggestions will be populated here -->
                        </div>
                    </div>
                    
                    <div id="loading-indicator" class="hidden text-center py-8">
                        <div class="inline-flex items-center gap-3 text-blue-600">
                            <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"></div>
                            <span class="text-lg">Looking up property details...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Property Confirmation -->
            <div id="wizard-step-2" class="wizard-step bg-white rounded-xl p-8 shadow-lg slide-up hidden">
                <div class="text-center mb-8">
                    <div class="text-4xl mb-4">üîç</div>
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">Confirm property details</h2>
                    <p class="text-gray-600">Please verify and update any information</p>
                </div>
                
                <div id="property-details" class="space-y-6">
                    <!-- Property details will be populated here -->
                </div>
                
                <div class="flex gap-4 mt-8">
                    <button onclick="prevStep()" class="flex-1 bg-gray-200 text-gray-700 py-3 px-6 rounded-lg hover:bg-gray-300 transition-colors">
                        Back
                    </button>
                    <button onclick="nextStep()" class="flex-1 bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors">
                        Looks Good
                    </button>
                </div>
            </div>

            <!-- Step 3: Heating & Cooling Systems -->
            <div id="wizard-step-3" class="wizard-step bg-white rounded-xl p-8 shadow-lg slide-up hidden">
                <div class="text-center mb-8">
                    <div class="text-4xl mb-4">üå°Ô∏è</div>
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">Heating & cooling systems</h2>
                    <p class="text-gray-600">Select all systems your home has</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="system-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer" onclick="toggleSystem(this, 'central-ac')">
                        <div class="flex items-center space-x-3">
                            <div class="text-2xl">‚ùÑÔ∏è</div>
                            <div>
                                <h4 class="font-medium">Central Air/Heat</h4>
                                <p class="text-sm text-gray-600">Whole-house HVAC system</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="system-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer" onclick="toggleSystem(this, 'mini-splits')">
                        <div class="flex items-center space-x-3">
                            <div class="text-2xl">üè†</div>
                            <div>
                                <h4 class="font-medium">Mini-Split Systems</h4>
                                <p class="text-sm text-gray-600">Ductless wall-mounted units</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="system-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer" onclick="toggleSystem(this, 'heat-pump')">
                        <div class="flex items-center space-x-3">
                            <div class="text-2xl">üî•</div>
                            <div>
                                <h4 class="font-medium">Heat Pump</h4>
                                <p class="text-sm text-gray-600">Electric heating/cooling</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="system-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer" onclick="toggleSystem(this, 'window-units')">
                        <div class="flex items-center space-x-3">
                            <div class="text-2xl">ü™ü</div>
                            <div>
                                <h4 class="font-medium">Window A/C Units</h4>
                                <p class="text-sm text-gray-600">Individual room units</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="system-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer" onclick="toggleSystem(this, 'baseboard')">
                        <div class="flex items-center space-x-3">
                            <div class="text-2xl">üìè</div>
                            <div>
                                <h4 class="font-medium">Baseboard Heat</h4>
                                <p class="text-sm text-gray-600">Electric or hot water</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="system-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer" onclick="toggleSystem(this, 'radiators')">
                        <div class="flex items-center space-x-3">
                            <div class="text-2xl">üî©</div>
                            <div>
                                <h4 class="font-medium">Radiators</h4>
                                <p class="text-sm text-gray-600">Steam or hot water</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="system-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer" onclick="toggleSystem(this, 'wood-stove')">
                        <div class="flex items-center space-x-3">
                            <div class="text-2xl">ü™µ</div>
                            <div>
                                <h4 class="font-medium">Wood Stove/Pellet</h4>
                                <p class="text-sm text-gray-600">Wood or pellet burning</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="system-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer" onclick="toggleSystem(this, 'geothermal')">
                        <div class="flex items-center space-x-3">
                            <div class="text-2xl">üåç</div>
                            <div>
                                <h4 class="font-medium">Geothermal</h4>
                                <p class="text-sm text-gray-600">Ground-source heat pump</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex gap-4 mt-8">
                    <button onclick="prevStep()" class="flex-1 bg-gray-200 text-gray-700 py-3 px-6 rounded-lg hover:bg-gray-300 transition-colors">
                        Back
                    </button>
                    <button onclick="nextStep()" class="flex-1 bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors">
                        Continue
                    </button>
                </div>
            </div>

            <!-- Step 4: Water & Utility Systems -->
            <div id="wizard-step-4" class="wizard-step bg-white rounded-xl p-8 shadow-lg slide-up hidden">
                <div class="text-center mb-8">
                    <div class="text-4xl mb-4">üíß</div>
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">Water & utility systems</h2>
                    <p class="text-gray-600">Tell us about your water and waste systems</p>
                </div>
                
                <div class="space-y-8">
                    <!-- Water Source -->
                    <div>
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Water Source</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="system-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer" onclick="selectWaterSource(this, 'city')">
                                <div class="flex items-center space-x-3">
                                    <div class="text-2xl">üè¢</div>
                                    <div>
                                        <h4 class="font-medium">City Water</h4>
                                        <p class="text-sm text-gray-600">Municipal water supply</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="system-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer" onclick="selectWaterSource(this, 'well')">
                                <div class="flex items-center space-x-3">
                                    <div class="text-2xl">üèîÔ∏è</div>
                                    <div>
                                        <h4 class="font-medium">Well Water</h4>
                                        <p class="text-sm text-gray-600">Private well system</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Waste Water -->
                    <div>
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Waste Water</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="system-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer" onclick="selectSewerType(this, 'public')">
                                <div class="flex items-center space-x-3">
                                    <div class="text-2xl">üåÜ</div>
                                    <div>
                                        <h4 class="font-medium">Public Sewer</h4>
                                        <p class="text-sm text-gray-600">Connected to municipal system</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="system-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer" onclick="selectSewerType(this, 'septic')">
                                <div class="flex items-center space-x-3">
                                    <div class="text-2xl">üèûÔ∏è</div>
                                    <div>
                                        <h4 class="font-medium">Septic System</h4>
                                        <p class="text-sm text-gray-600">On-site waste treatment</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Water Treatment -->
                    <div>
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Water Treatment (Optional)</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="system-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer" onclick="toggleSystem(this, 'water-softener')">
                                <div class="text-center">
                                    <div class="text-2xl mb-2">üßÇ</div>
                                    <h4 class="font-medium">Water Softener</h4>
                                </div>
                            </div>
                            
                            <div class="system-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer" onclick="toggleSystem(this, 'filtration')">
                                <div class="text-center">
                                    <div class="text-2xl mb-2">üö∞</div>
                                    <h4 class="font-medium">Filtration System</h4>
                                </div>
                            </div>
                            
                            <div class="system-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer" onclick="toggleSystem(this, 'reverse-osmosis')">
                                <div class="text-center">
                                    <div class="text-2xl mb-2">üíé</div>
                                    <h4 class="font-medium">Reverse Osmosis</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex gap-4 mt-8">
                    <button onclick="prevStep()" class="flex-1 bg-gray-200 text-gray-700 py-3 px-6 rounded-lg hover:bg-gray-300 transition-colors">
                        Back
                    </button>
                    <button onclick="nextStep()" class="flex-1 bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors">
                        Continue
                    </button>
                </div>
            </div>

            <!-- Step 5: Home Features & Preferences -->
            <div id="wizard-step-5" class="wizard-step bg-white rounded-xl p-8 shadow-lg slide-up hidden">
                <div class="text-center mb-8">
                    <div class="text-4xl mb-4">üè°</div>
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">Home features & preferences</h2>
                    <p class="text-gray-600">Final details to customize your maintenance plan</p>
                </div>
                
                <div class="space-y-8">
                    <!-- Home Features -->
                    <div>
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Home Features</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="system-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer" onclick="toggleSystem(this, 'fireplace')">
                                <div class="text-center">
                                    <div class="text-2xl mb-2">üî•</div>
                                    <h4 class="font-medium text-sm">Fireplace</h4>
                                </div>
                            </div>
                            
                            <div class="system-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer" onclick="toggleSystem(this, 'pool')">
                                <div class="text-center">
                                    <div class="text-2xl mb-2">üèä</div>
                                    <h4 class="font-medium text-sm">Pool/Spa</h4>
                                </div>
                            </div>
                            
                            <div class="system-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer" onclick="toggleSystem(this, 'deck')">
                                <div class="text-center">
                                    <div class="text-2xl mb-2">üõ§Ô∏è</div>
                                    <h4 class="font-medium text-sm">Deck/Patio</h4>
                                </div>
                            </div>
                            
                            <div class="system-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer" onclick="toggleSystem(this, 'garage')">
                                <div class="text-center">
                                    <div class="text-2xl mb-2">üöó</div>
                                    <h4 class="font-medium text-sm">Garage</h4>
                                </div>
                            </div>
                            
                            <div class="system-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer" onclick="toggleSystem(this, 'basement')">
                                <div class="text-center">
                                    <div class="text-2xl mb-2">üè†</div>
                                    <h4 class="font-medium text-sm">Basement</h4>
                                </div>
                            </div>
                            
                            <div class="system-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer" onclick="toggleSystem(this, 'attic')">
                                <div class="text-center">
                                    <div class="text-2xl mb-2">üè†</div>
                                    <h4 class="font-medium text-sm">Attic</h4>
                                </div>
                            </div>
                            
                            <div class="system-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer" onclick="toggleSystem(this, 'security')">
                                <div class="text-center">
                                    <div class="text-2xl mb-2">üõ°Ô∏è</div>
                                    <h4 class="font-medium text-sm">Security</h4>
                                </div>
                            </div>
                            
                            <div class="system-card border-2 border-gray-200 rounded-lg p-4 cursor-pointer" onclick="toggleSystem(this, 'solar')">
                                <div class="text-center">
                                    <div class="text-2xl mb-2">‚òÄÔ∏è</div>
                                    <h4 class="font-medium text-sm">Solar</h4>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Lifestyle Questions -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">Do you have pets?</label>
                            <div class="flex gap-4">
                                <label class="flex items-center space-x-2">
                                    <input type="radio" name="pets" value="no" checked class="text-blue-600">
                                    <span>No</span>
                                </label>
                                <label class="flex items-center space-x-2">
                                    <input type="radio" name="pets" value="yes" class="text-blue-600">
                                    <span>Yes</span>
                                </label>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">How many people live here?</label>
                            <select id="occupancy" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="1-2">1-2 people</option>
                                <option value="3-4" selected>3-4 people</option>
                                <option value="5+">5+ people</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">Maintenance approach</label>
                        <div class="space-y-3">
                            <label class="flex items-start space-x-3 p-3 border rounded-lg hover:bg-gray-50 cursor-pointer">
                                <input type="radio" name="approach" value="proactive" checked class="mt-1 text-blue-600">
                                <div>
                                    <span class="font-medium">Proactive</span>
                                    <p class="text-sm text-gray-600">Stay ahead of issues with frequent maintenance</p>
                                </div>
                            </label>
                            <label class="flex items-start space-x-3 p-3 border rounded-lg hover:bg-gray-50 cursor-pointer">
                                <input type="radio" name="approach" value="standard" class="mt-1 text-blue-600">
                                <div>
                                    <span class="font-medium">Standard</span>
                                    <p class="text-sm text-gray-600">Follow typical maintenance schedules</p>
                                </div>
                            </label>
                            <label class="flex items-start space-x-3 p-3 border rounded-lg hover:bg-gray-50 cursor-pointer">
                                <input type="radio" name="approach" value="minimal" class="mt-1 text-blue-600">
                                <div>
                                    <span class="font-medium">Minimal</span>
                                    <p class="text-sm text-gray-600">Only essential maintenance tasks</p>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="flex gap-4 mt-8">
                    <button onclick="prevStep()" class="flex-1 bg-gray-200 text-gray-700 py-3 px-6 rounded-lg hover:bg-gray-300 transition-colors">
                        Back
                    </button>
                    <button onclick="generateMaintenancePlan()" class="flex-1 bg-green-600 text-white py-3 px-6 rounded-lg hover:bg-green-700 transition-colors font-medium text-lg">
                        üöÄ Create My Plan
                    </button>
                </div>
            </div>
        </div>

        <!-- Main App -->
        <div id="main-app" class="hidden">
            <!-- Navigation -->
            <div class="max-w-6xl mx-auto px-4 py-6">
                <div class="flex space-x-1 bg-white rounded-xl p-2 shadow-lg">
                    <button onclick="showAppTab('dashboard')" id="app-tab-dashboard" class="app-tab-btn bg-blue-100 text-blue-700 px-6 py-3 rounded-lg font-medium">
                        üìÖ Dashboard
                    </button>
                    <button onclick="showAppTab('tasks')" id="app-tab-tasks" class="app-tab-btn text-gray-600 hover:text-gray-900 px-6 py-3 rounded-lg font-medium">
                        ‚úÖ All Tasks
                    </button>
                    <button onclick="showAppTab('appliances')" id="app-tab-appliances" class="app-tab-btn text-gray-600 hover:text-gray-900 px-6 py-3 rounded-lg font-medium">
                        üîß Appliances
                    </button>
                    <button onclick="showAppTab('calendar')" id="app-tab-calendar" class="app-tab-btn text-gray-600 hover:text-gray-900 px-6 py-3 rounded-lg font-medium">
                        üìÜ Schedule
                    </button>
                    <button onclick="showAppTab('documentation')" id="app-tab-documentation" class="app-tab-btn text-gray-600 hover:text-gray-900 px-6 py-3 rounded-lg font-medium">
                        üìã Records
                    </button>
                    <button onclick="showAppTab('settings')" id="app-tab-settings" class="app-tab-btn text-gray-600 hover:text-gray-900 px-6 py-3 rounded-lg font-medium">
                        ‚öôÔ∏è Settings
                    </button>
                </div>
            </div>

            <!-- Dashboard Tab -->
            <div id="app-dashboard" class="app-content max-w-6xl mx-auto px-4 pb-8">
                <!-- Welcome Back -->
                <div class="gradient-bg text-white rounded-2xl p-8 shadow-2xl mb-8">
                    <h2 class="text-2xl font-bold mb-2">Welcome back! üëã</h2>
                    <p class="text-blue-100" id="dashboard-address">Managing maintenance for your home</p>
                    <div class="mt-4 text-blue-100" id="dashboard-stats">
                        <span id="api-mode-indicator">Smart Demo Mode</span>
                    </div>
                </div>

                <!-- Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-red-100 rounded-lg">‚ö†Ô∏è</div>
                            <div>
                                <p class="text-sm text-gray-600">Overdue</p>
                                <p id="overdue-count" class="text-2xl font-bold text-gray-900">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-orange-100 rounded-lg">üìÖ</div>
                            <div>
                                <p class="text-sm text-gray-600">This Week</p>
                                <p id="week-count" class="text-2xl font-bold text-gray-900">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-blue-100 rounded-lg">üìã</div>
                            <div>
                                <p class="text-sm text-gray-600">Total Tasks</p>
                                <p id="total-count" class="text-2xl font-bold text-gray-900">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-green-100 rounded-lg">üí∞</div>
                            <div>
                                <p class="text-sm text-gray-600">Est. Annual</p>
                                <p id="annual-cost" class="text-2xl font-bold text-gray-900">$0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Upcoming Tasks -->
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden mb-8">
                    <div class="p-6 border-b border-gray-100">
                        <h3 class="text-xl font-bold text-gray-900">Upcoming Tasks</h3>
                        <p class="text-gray-600">Tasks due in the next 2 weeks</p>
                    </div>
                    <div id="upcoming-tasks-list">
                        <!-- Tasks will be populated here -->
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div class="bg-white rounded-xl p-6 shadow-lg text-center">
                        <div class="text-3xl mb-3">‚ûï</div>
                        <h3 class="font-semibold mb-2">Add Custom Task</h3>
                        <p class="text-sm text-gray-600 mb-4">Create a personalized maintenance reminder</p>
                        <button onclick="addCustomTask()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                            Add Task
                        </button>
                    </div>
                    
                    <div class="bg-white rounded-xl p-6 shadow-lg text-center">
                        <div class="text-3xl mb-3">üîß</div>
                        <h3 class="font-semibold mb-2">Add Appliance</h3>
                        <p class="text-sm text-gray-600 mb-4">Track appliance models and get part links</p>
                        <button onclick="showAppTab('appliances')" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                            Manage
                        </button>
                    </div>
                    
                    <div class="bg-white rounded-xl p-6 shadow-lg text-center">
                        <div class="text-3xl mb-3">üìÖ</div>
                        <h3 class="font-semibold mb-2">Export Calendar</h3>
                        <p class="text-sm text-gray-600 mb-4">Sync with Google, Outlook, or Apple</p>
                        <button onclick="exportCalendar()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                            Export
                        </button>
                    </div>
                    
                    <div class="bg-white rounded-xl p-6 shadow-lg text-center">
                        <div class="text-3xl mb-3">üìÑ</div>
                        <h3 class="font-semibold mb-2">Export Data</h3>
                        <p class="text-sm text-gray-600 mb-4">Download your maintenance plan</p>
                        <button onclick="exportData()" class="bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700">
                            Export
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tasks Tab -->
            <div id="app-tasks" class="app-content hidden max-w-6xl mx-auto px-4 pb-8">
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                    <div class="p-6 border-b border-gray-100 flex items-center justify-between">
                        <div>
                            <h3 class="text-xl font-bold text-gray-900">All Maintenance Tasks</h3>
                            <p class="text-gray-600">Complete maintenance schedule organized by category</p>
                        </div>
                        <button onclick="addCustomTask()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                            ‚ûï Add Custom Task
                        </button>
                    </div>
                    <div id="all-tasks-list">
                        <!-- All tasks will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Appliances Tab -->
            <div id="app-appliances" class="app-content hidden max-w-6xl mx-auto px-4 pb-8">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Appliance List -->
                    <div class="lg:col-span-2">
                        <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                            <div class="p-6 border-b border-gray-100 flex items-center justify-between">
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900">My Appliances</h3>
                                    <p class="text-gray-600">Track models, warranties, and get replacement parts</p>
                                </div>
                                <button onclick="addAppliance()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                    ‚ûï Add Appliance
                                </button>
                            </div>
                            <div id="appliances-list">
                                <!-- Appliances will be populated here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Appliance Stats -->
                    <div class="space-y-6">
                        <div class="bg-white rounded-xl p-6 shadow-lg">
                            <h4 class="font-semibold text-gray-900 mb-4">Appliance Overview</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Total Appliances</span>
                                    <span id="total-appliances" class="font-semibold">0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Under Warranty</span>
                                    <span id="warranty-count" class="font-semibold text-green-600">0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Need Service</span>
                                    <span id="service-needed" class="font-semibold text-orange-600">0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Avg Age</span>
                                    <span id="avg-age" class="font-semibold">0 years</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl p-6 shadow-lg">
                            <h4 class="font-semibold text-gray-900 mb-4">Upcoming Replacements</h4>
                            <div id="replacement-alerts" class="space-y-2">
                                <p class="text-sm text-gray-500">No replacements needed soon</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Documentation Tab -->
            <div id="app-documentation" class="app-content hidden max-w-6xl mx-auto px-4 pb-8">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Service History -->
                    <div class="lg:col-span-2">
                        <div class="bg-white rounded-2xl shadow-lg overflow-hidden mb-8">
                            <div class="p-6 border-b border-gray-100 flex items-center justify-between">
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900">Service History</h3>
                                    <p class="text-gray-600">Completed maintenance tasks and documentation</p>
                                </div>
                                <button onclick="addServiceRecord()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                    ‚ûï Add Record
                                </button>
                            </div>
                            <div id="service-history-list">
                                <!-- Service history will be populated here -->
                            </div>
                        </div>
                        
                        <!-- Service Providers -->
                        <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                            <div class="p-6 border-b border-gray-100 flex items-center justify-between">
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900">Service Providers</h3>
                                    <p class="text-gray-600">Your trusted contractors and service companies</p>
                                </div>
                                <button onclick="addServiceProvider()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                                    ‚ûï Add Provider
                                </button>
                            </div>
                            <div id="service-providers-list">
                                <!-- Service providers will be populated here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Documentation Stats -->
                    <div class="space-y-6">
                        <div class="bg-white rounded-xl p-6 shadow-lg">
                            <h4 class="font-semibold text-gray-900 mb-4">Documentation Stats</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Completed Tasks</span>
                                    <span id="completed-tasks-count" class="font-semibold">0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Total Spent</span>
                                    <span id="total-spent" class="font-semibold text-green-600">$0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Service Providers</span>
                                    <span id="providers-count" class="font-semibold">0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Photos Stored</span>
                                    <span id="photos-count" class="font-semibold">0</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl p-6 shadow-lg">
                            <h4 class="font-semibold text-gray-900 mb-4">Recent Activity</h4>
                            <div id="recent-activity" class="space-y-2">
                                <p class="text-sm text-gray-500">No recent activity</p>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl p-6 shadow-lg">
                            <h4 class="font-semibold text-gray-900 mb-4">Quick Actions</h4>
                            <div class="space-y-2">
                                <button onclick="exportServiceHistory()" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 text-sm">
                                    üìÑ Export Service History
                                </button>
                                <button onclick="exportWarranties()" class="w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 text-sm">
                                    üìã Export Warranties
                                </button>
                                <button onclick="viewSpendingReport()" class="w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 text-sm">
                                    üí∞ Spending Report
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-900 mb-6">Maintenance Schedule</h3>
                    <div id="calendar-view" class="space-y-6">
                        <!-- Calendar view will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="app-settings" class="app-content hidden max-w-6xl mx-auto px-4 pb-8">
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-900 mb-6">Settings</h3>
                    
                    <div class="space-y-8">
                        <div>
                            <h4 class="font-medium text-gray-900 mb-3">Property Information</h4>
                            <div class="bg-gray-50 rounded-lg p-4 mb-4">
                                <div id="property-summary">
                                    <!-- Property summary will be populated here -->
                                </div>
                            </div>
                            <button onclick="restartWizard()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                Update Property Details
                            </button>
                        </div>
                        
                        <div>
                            <h4 class="font-medium text-gray-900 mb-3">API Configuration</h4>
                            <div class="flex items-center gap-4 mb-4">
                                <span class="text-sm text-gray-600">Current mode:</span>
                                <span id="current-api-status" class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm">Smart Demo Mode</span>
                            </div>
                            <button onclick="updateApiKey()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                                Change API Settings
                            </button>
                        </div>
                        
                        <div>
                            <h4 class="font-medium text-gray-900 mb-3">Data Management</h4>
                            <div class="space-y-3">
                                <button onclick="exportData()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 mr-3">
                                    üìÑ Export Data
                                </button>
                                <br>
                                <button onclick="clearData()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">
                                    üóëÔ∏è Clear All Data
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Task Modal -->
        <div id="task-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
            <div class="bg-white rounded-xl max-w-md w-full mx-4 p-6">
                <h3 class="text-xl font-bold mb-4" id="modal-title">Task</h3>
                <div id="modal-content"></div>
                <div class="flex gap-3 mt-6">
                    <button onclick="closeModal()" class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-lg hover:bg-gray-300">Cancel</button>
                    <button onclick="confirmTaskAction()" id="modal-confirm" class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">Confirm</button>
                </div>
            </div>
        </div>

        <!-- Appliance Modal -->
        <div id="appliance-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
            <div class="bg-white rounded-xl max-w-lg w-full mx-4 p-6 max-h-[90vh] overflow-y-auto">
                <h3 class="text-xl font-bold mb-4" id="appliance-modal-title">Add Appliance</h3>
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Appliance Type</label>
                            <select id="appliance-type" class="w-full p-3 border rounded-lg">
                                <option value="">Select type...</option>
                                <option value="HVAC">HVAC System</option>
                                <option value="Water Heater">Water Heater</option>
                                <option value="Refrigerator">Refrigerator</option>
                                <option value="Washer">Washer</option>
                                <option value="Dryer">Dryer</option>
                                <option value="Dishwasher">Dishwasher</option>
                                <option value="Oven/Range">Oven/Range</option>
                                <option value="Microwave">Microwave</option>
                                <option value="Garbage Disposal">Garbage Disposal</option>
                                <option value="Pool Equipment">Pool Equipment</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Brand</label>
                            <input type="text" id="appliance-brand" placeholder="e.g., Whirlpool" class="w-full p-3 border rounded-lg">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Model Number</label>
                        <input type="text" id="appliance-model" placeholder="e.g., WTW5000DW" class="w-full p-3 border rounded-lg">
                        <p class="text-xs text-gray-500 mt-1">Used to find replacement parts and manuals</p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Purchase Date</label>
                            <input type="date" id="appliance-purchase-date" class="w-full p-3 border rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Warranty (years)</label>
                            <input type="number" id="appliance-warranty" placeholder="1" class="w-full p-3 border rounded-lg">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Location</label>
                        <input type="text" id="appliance-location" placeholder="e.g., Kitchen, Basement" class="w-full p-3 border rounded-lg">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Serial Number (optional)</label>
                        <input type="text" id="appliance-serial" placeholder="For warranty registration" class="w-full p-3 border rounded-lg">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                        <textarea id="appliance-notes" placeholder="Installation notes, special instructions..." class="w-full p-3 border rounded-lg" rows="2"></textarea>
                    </div>
                </div>
                <div class="flex gap-3 mt-6">
                    <button onclick="closeApplianceModal()" class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-lg hover:bg-gray-300">Cancel</button>
                    <button onclick="saveAppliance()" class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">Save Appliance</button>
                </div>
            </div>
        </div>

        <!-- Service Provider Modal -->
        <div id="provider-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
            <div class="bg-white rounded-xl max-w-md w-full mx-4 p-6">
                <h3 class="text-xl font-bold mb-4" id="provider-modal-title">Add Service Provider</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Company Name</label>
                        <input type="text" id="provider-name" placeholder="e.g., ABC Plumbing" class="w-full p-3 border rounded-lg">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Service Type</label>
                        <select id="provider-type" class="w-full p-3 border rounded-lg">
                            <option value="HVAC">HVAC</option>
                            <option value="Plumbing">Plumbing</option>
                            <option value="Electrical">Electrical</option>
                            <option value="Appliance Repair">Appliance Repair</option>
                            <option value="Pool Service">Pool Service</option>
                            <option value="Landscaping">Landscaping</option>
                            <option value="Roofing">Roofing</option>
                            <option value="General Contractor">General Contractor</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                            <input type="tel" id="provider-phone" placeholder="(555) 123-4567" class="w-full p-3 border rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Rating</label>
                            <select id="provider-rating" class="w-full p-3 border rounded-lg">
                                <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Excellent</option>
                                <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê Good</option>
                                <option value="3">‚≠ê‚≠ê‚≠ê Average</option>
                                <option value="2">‚≠ê‚≠ê Poor</option>
                                <option value="1">‚≠ê Very Poor</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Email (optional)</label>
                        <input type="email" id="provider-email" placeholder="contact@abcplumbing.com" class="w-full p-3 border rounded-lg">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                        <textarea id="provider-notes" placeholder="Special rates, preferred contact method..." class="w-full p-3 border rounded-lg" rows="2"></textarea>
                    </div>
                </div>
                <div class="flex gap-3 mt-6">
                    <button onclick="closeProviderModal()" class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-lg hover:bg-gray-300">Cancel</button>
                    <button onclick="saveServiceProvider()" class="flex-1 bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">Save Provider</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global app state
        let currentStep = 1;
        let propertyData = {};
        let userPreferences = {};
        let maintenanceTasks = [];
        let appliances = [];
        let serviceProviders = [];
        let serviceHistory = [];
        let selectedSystems = new Set();
        let currentModalAction = null;
        let apiKey = null;
        let demoMode = false;
        let searchTimeout = null;
        let currentEditingAppliance = null;
        let currentEditingProvider = null;

        // API and data functions
        function saveApiKey() {
            const key = document.getElementById('api-key-input').value.trim();
            if (!key) {
                alert('Please enter your API key or use demo mode');
                return;
            }
            
            apiKey = key;
            demoMode = false;
            localStorage.setItem('casaCareApiKey', key);
            
            startWizard();
        }

        function useDemoMode() {
            demoMode = true;
            apiKey = null;
            localStorage.setItem('casaCareDemoMode', 'true');
            startWizard();
        }

        function startWizard() {
            document.getElementById('api-setup').classList.add('hidden');
            document.getElementById('setup-wizard').classList.remove('hidden');
            updateProgressIndicators();
        }

        function updateApiKey() {
            document.getElementById('api-setup').classList.remove('hidden');
            document.getElementById('setup-wizard').classList.add('hidden');
            document.getElementById('main-app').classList.add('hidden');
        }

        // Address search with Google Places API
        function searchAddresses(query) {
            if (searchTimeout) {
                clearTimeout(searchTimeout);
            }
            
            if (query.length < 3) {
                hideAddressSuggestions();
                return;
            }
            
            searchTimeout = setTimeout(() => {
                if (demoMode || !apiKey) {
                    showDemoAddressSuggestions(query);
                } else {
                    searchRealAddresses(query);
                }
            }, 300);
        }

        function showDemoAddressSuggestions(query) {
            const demoAddresses = [
                "123 Oak Street, Springfield, IL 62701",
                "456 Maple Avenue, Portland, OR 97201", 
                "789 Pine Road, Austin, TX 73301",
                "321 Elm Street, Denver, CO 80201",
                "654 Cedar Lane, Seattle, WA 98101",
                "987 Birch Drive, Boston, MA 02101"
            ].filter(addr => addr.toLowerCase().includes(query.toLowerCase()));
            
            displayAddressSuggestions(demoAddresses);
        }

        async function searchRealAddresses(query) {
            try {
                // Note: This would need a backend proxy to work due to CORS
                // For now, falling back to demo mode
                console.log('API search attempted:', query);
                showDemoAddressSuggestions(query);
            } catch (error) {
                console.error('Address search error:', error);
                showDemoAddressSuggestions(query);
            }
        }

        function displayAddressSuggestions(suggestions) {
            const container = document.getElementById('address-suggestions');
            
            if (suggestions.length === 0) {
                hideAddressSuggestions();
                return;
            }
            
            container.innerHTML = suggestions.map((address, index) => `
                <div class="address-suggestion p-3 border-b border-gray-100 last:border-b-0" onclick="selectAddressByIndex(${index})">
                    <div class="text-sm text-gray-900">${address}</div>
                </div>
            `).join('');
            
            // Store suggestions temporarily for selection
            container.dataset.suggestions = JSON.stringify(suggestions);
            
            container.classList.remove('hidden');
        }

        function selectAddressByIndex(index) {
            const container = document.getElementById('address-suggestions');
            const suggestions = JSON.parse(container.dataset.suggestions || '[]');
            const address = suggestions[index];
            if (address) {
                selectAddress(address);
            }
        }

        function hideAddressSuggestions() {
            document.getElementById('address-suggestions').classList.add('hidden');
        }

        function selectAddress(address) {
            document.getElementById('address-input').value = address;
            hideAddressSuggestions();
            lookupPropertyDetails(address);
        }

        // Property lookup and generation
        async function lookupPropertyDetails(address) {
            document.getElementById('loading-indicator').classList.remove('hidden');
            
            setTimeout(() => {
                propertyData = generateSmartPropertyData(address);
                document.getElementById('loading-indicator').classList.add('hidden');
                populatePropertyDetails();
                nextStep();
            }, 1500);
        }

        function generateSmartPropertyData(address) {
            const state = address.match(/\b([A-Z]{2})\b/)?.[1] || 'NY';
            const zipCode = address.match(/\b(\d{5})\b/)?.[1] || '12345';
            
            // Regional patterns for more realistic data
            let yearBuilt, sqft, waterSource, sewerType;
            
            if (['CA', 'FL', 'TX', 'AZ', 'NV'].includes(state)) {
                yearBuilt = 1985 + Math.floor(Math.random() * 35);
                sqft = 1800 + Math.floor(Math.random() * 1500);
                waterSource = 'City Water';
                sewerType = 'Public Sewer';
            } else if (['VT', 'NH', 'ME', 'MT', 'WY', 'ID'].includes(state)) {
                yearBuilt = 1960 + Math.floor(Math.random() * 45);
                sqft = 1400 + Math.floor(Math.random() * 1200);
                waterSource = Math.random() > 0.4 ? 'Well Water' : 'City Water';
                sewerType = Math.random() > 0.3 ? 'Septic System' : 'Public Sewer';
            } else {
                yearBuilt = 1975 + Math.floor(Math.random() * 40);
                sqft = 1600 + Math.floor(Math.random() * 1400);
                waterSource = Math.random() > 0.7 ? 'Well Water' : 'City Water';
                sewerType = Math.random() > 0.6 ? 'Septic System' : 'Public Sewer';
            }
            
            const bedrooms = 2 + Math.floor(Math.random() * 4);
            const bathrooms = Math.max(1, Math.floor(bedrooms * 0.75)) + (Math.random() > 0.5 ? 0.5 : 0);
            
            return {
                address: address,
                yearBuilt: yearBuilt,
                squareFootage: sqft,
                bedrooms: bedrooms,
                bathrooms: bathrooms,
                propertyType: 'Single Family',
                waterSource: waterSource,
                sewerType: sewerType,
                heatingType: yearBuilt > 1990 ? 'Central Air/Heat' : 'Mixed Systems',
                lotSize: (0.15 + Math.random() * 0.4).toFixed(2) + ' acres'
            };
        }

        function populatePropertyDetails() {
            const container = document.getElementById('property-details');
            container.innerHTML = `
                <div class="bg-blue-50 rounded-lg p-4 mb-6">
                    <h4 class="font-medium text-blue-900 mb-2">üìç ${propertyData.address}</h4>
                    <p class="text-sm text-blue-700">Property details ${demoMode ? '(Smart Demo Data)' : '(Live Data)'}</p>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Year Built</label>
                        <input type="number" value="${propertyData.yearBuilt}" 
                               class="w-full px-3 py-2 border rounded-lg" 
                               onchange="propertyData.yearBuilt = this.value">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Square Footage</label>
                        <input type="number" value="${propertyData.squareFootage}" 
                               class="w-full px-3 py-2 border rounded-lg"
                               onchange="propertyData.squareFootage = this.value">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Bedrooms</label>
                        <input type="number" value="${propertyData.bedrooms}" 
                               class="w-full px-3 py-2 border rounded-lg"
                               onchange="propertyData.bedrooms = this.value">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Bathrooms</label>
                        <input type="number" step="0.5" value="${propertyData.bathrooms}" 
                               class="w-full px-3 py-2 border rounded-lg"
                               onchange="propertyData.bathrooms = this.value">
                    </div>
                </div>
                <div class="mt-4">
                    <p class="text-sm text-gray-600">Water: <strong>${propertyData.waterSource}</strong> ‚Ä¢ 
                    Sewer: <strong>${propertyData.sewerType}</strong> ‚Ä¢ 
                    Lot: <strong>${propertyData.lotSize}</strong></p>
                </div>
            `;
            
        // System selection functions
        function toggleSystem(element, systemId) {
            element.classList.toggle('selected');
            
            if (selectedSystems.has(systemId)) {
                selectedSystems.delete(systemId);
            } else {
                selectedSystems.add(systemId);
            }
        }

        function selectWaterSource(element, source) {
            // Clear previous selection
            document.querySelectorAll('#wizard-step-4 .system-card').forEach(card => {
                if (card.onclick.toString().includes('selectWaterSource')) {
                    card.classList.remove('selected');
                }
            });
            
            element.classList.add('selected');
            userPreferences.waterSource = source;
        }

        function selectSewerType(element, type) {
            // Clear previous selection
            document.querySelectorAll('#wizard-step-4 .system-card').forEach(card => {
                if (card.onclick.toString().includes('selectSewerType')) {
                    card.classList.remove('selected');
                }
            });
            
            element.classList.add('selected');
            userPreferences.sewerType = type;
        }

        // Wizard navigation
        function nextStep() {
            if (currentStep < 5) {
                document.getElementById(`wizard-step-${currentStep}`).classList.add('hidden');
                currentStep++;
                document.getElementById(`wizard-step-${currentStep}`).classList.remove('hidden');
                updateProgressIndicators();
                
                // Pre-select systems based on property data on step 4
                if (currentStep === 4) {
                    preselectWaterSystems();
                }
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                document.getElementById(`wizard-step-${currentStep}`).classList.add('hidden');
                currentStep--;
                document.getElementById(`wizard-step-${currentStep}`).classList.remove('hidden');
                updateProgressIndicators();
            }
        }

        function preselectWaterSystems() {
            setTimeout(() => {
                // Pre-select water source
                const waterCards = document.querySelectorAll('#wizard-step-4 .system-card');
                waterCards.forEach(card => {
                    if (card.onclick.toString().includes('selectWaterSource')) {
                        if ((userPreferences.waterSource === 'well' && card.onclick.toString().includes("'well'")) ||
                            (userPreferences.waterSource === 'city' && card.onclick.toString().includes("'city'"))) {
                            card.classList.add('selected');
                        }
                    }
                    if (card.onclick.toString().includes('selectSewerType')) {
                        if ((userPreferences.sewerType === 'septic' && card.onclick.toString().includes("'septic'")) ||
                            (userPreferences.sewerType === 'public' && card.onclick.toString().includes("'public'"))) {
                            card.classList.add('selected');
                        }
                    }
                });
            }, 100);
        }

        function updateProgressIndicators() {
            for (let i = 1; i <= 5; i++) {
                const step = document.getElementById(`step-${i}`);
                if (i < currentStep) {
                    step.className = 'step-indicator step-completed w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold';
                } else if (i === currentStep) {
                    step.className = 'step-indicator step-active w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold';
                } else {
                    step.className = 'step-indicator w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-sm font-bold text-gray-500';
                }
            }
        }

        // Generate comprehensive maintenance plan
        function generateMaintenancePlan() {
            // Collect final preferences
            userPreferences.hvacSystems = Array.from(selectedSystems).filter(s => 
                ['central-ac', 'mini-splits', 'heat-pump', 'window-units', 'baseboard', 'radiators', 'wood-stove', 'geothermal'].includes(s)
            );
            userPreferences.waterTreatment = Array.from(selectedSystems).filter(s => 
                ['water-softener', 'filtration', 'reverse-osmosis'].includes(s)
            );
            userPreferences.features = Array.from(selectedSystems).filter(s => 
                ['fireplace', 'pool', 'deck', 'garage', 'basement', 'attic', 'security', 'solar'].includes(s)
            );
            userPreferences.pets = document.querySelector('input[name="pets"]:checked').value;
            userPreferences.occupancy = document.getElementById('occupancy').value;
            userPreferences.approach = document.querySelector('input[name="approach"]:checked').value;

            // Generate tasks
            maintenanceTasks = generateComprehensiveTasks(propertyData, userPreferences);
            
            // Save data
            saveData();

            // Switch to main app
            document.getElementById('setup-wizard').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            
            // Initialize main app
            initializeMainApp();
        }

        function generateComprehensiveTasks(property, preferences) {
            const tasks = [];
            let taskId = 1;

            // Frequency modifiers
            const frequencyModifier = {
                'proactive': 0.8,
                'standard': 1.0,
                'minimal': 1.3
            }[preferences.approach];

            const petModifier = preferences.pets === 'yes' ? 0.75 : 1.0;
            const occupancyModifier = preferences.occupancy === '5+' ? 0.9 : preferences.occupancy === '1-2' ? 1.1 : 1.0;

            // HVAC Tasks
            if (preferences.hvacSystems.includes('central-ac')) {
                tasks.push({
                    id: taskId++,
                    title: 'Replace HVAC Filter',
                    category: 'HVAC',
                    frequency: Math.round(90 * frequencyModifier * petModifier),
                    priority: 'high',
                    cost: 25,
                    description: 'Replace central air system filter to maintain air quality and efficiency',
                    tips: preferences.pets === 'yes' ? 'Check monthly due to pet hair and dander' : 'Standard quarterly replacement',
                    lastCompleted: null,
                    nextDue: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000)
                });

                tasks.push({
                    id: taskId++,
                    title: 'HVAC Professional Service',
                    category: 'HVAC',
                    frequency: Math.round(365 * frequencyModifier),
                    priority: 'medium',
                    cost: 150,
                    description: 'Annual professional HVAC maintenance and tune-up',
                    tips: 'Schedule before peak heating/cooling seasons for best results',
                    lastCompleted: null,
                    nextDue: new Date(Date.now() + 45 * 24 * 60 * 60 * 1000)
                });
            }

            if (preferences.hvacSystems.includes('mini-splits')) {
                tasks.push({
                    id: taskId++,
                    title: 'Clean Mini-Split Filters',
                    category: 'HVAC',
                    frequency: Math.round(60 * frequencyModifier * petModifier),
                    priority: 'medium',
                    cost: 0,
                    description: 'Remove and wash mini-split unit filters',
                    tips: 'Rinse with warm water and let dry completely before reinstalling',
                    lastCompleted: null,
                    nextDue: new Date(Date.now() + 21 * 24 * 60 * 60 * 1000)
                });
            }

            if (preferences.hvacSystems.includes('heat-pump')) {
                tasks.push({
                    id: taskId++,
                    title: 'Heat Pump Maintenance',
                    category: 'HVAC',
                    frequency: Math.round(180 * frequencyModifier),
                    priority: 'medium',
                    cost: 100,
                    description: 'Professional heat pump inspection and maintenance',
                    tips: 'Include outdoor unit cleaning and refrigerant level check',
                    lastCompleted: null,
                    nextDue: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000)
                });
            }

            if (preferences.hvacSystems.includes('baseboard')) {
                tasks.push({
                    id: taskId++,
                    title: 'Clean Baseboard Heaters',
                    category: 'HVAC',
                    frequency: Math.round(120 * frequencyModifier),
                    priority: 'low',
                    cost: 0,
                    description: 'Vacuum and dust baseboard heating elements',
                    tips: 'Turn off power before cleaning, check for blocked vents',
                    lastCompleted: null,
                    nextDue: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000)
                });
            }

            if (preferences.hvacSystems.includes('geothermal')) {
                tasks.push({
                    id: taskId++,
                    title: 'Geothermal System Service',
                    category: 'HVAC',
                    frequency: Math.round(365 * frequencyModifier),
                    priority: 'high',
                    cost: 200,
                    description: 'Professional geothermal system inspection and maintenance',
                    tips: 'Check loop pressure and heat exchanger efficiency',
                    lastCompleted: null,
                    nextDue: new Date(Date.now() + 90 * 24 * 60 * 60 * 1000)
                });
            }

            // Water System Tasks
            if (preferences.waterSource === 'well') {
                tasks.push({
                    id: taskId++,
                    title: 'Test Well Water Quality',
                    category: 'Water Systems',
                    frequency: Math.round(365 * frequencyModifier),
                    priority: 'high',
                    cost: 75,
                    description: 'Annual water quality testing for bacteria, nitrates, and minerals',
                    tips: 'Required by health departments, test more frequently if taste/odor changes',
                    lastCompleted: null,
                    nextDue: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000)
                });

                tasks.push({
                    id: taskId++,
                    title: 'Well Pump Inspection',
                    category: 'Water Systems',
                    frequency: Math.round(1095 * frequencyModifier), // 3 years
                    priority: 'medium',
                    cost: 200,
                    description: 'Professional inspection of well pump and pressure tank',
                    tips: 'Check for unusual noises, pressure issues, or electrical problems',
                    lastCompleted: null,
                    nextDue: new Date(Date.now() + 120 * 24 * 60 * 60 * 1000)
                });
            }

            if (preferences.sewerType === 'septic') {
                const pumpingFrequency = preferences.occupancy === '5+' ? 1095 : preferences.occupancy === '1-2' ? 1825 : 1460; // 3-5 years based on occupancy
                tasks.push({
                    id: taskId++,
                    title: 'Septic Tank Pumping',
                    category: 'Water Systems',
                    frequency: Math.round(pumpingFrequency * frequencyModifier),
                    priority: 'high',
                    cost: 400,
                    description: 'Professional septic tank pumping and inspection',
                    tips: `Recommended every ${Math.round(pumpingFrequency/365)} years for ${preferences.occupancy} occupants`,
                    lastCompleted: null,
                    nextDue: new Date(Date.now() + 180 * 24 * 60 * 60 * 1000)
                });
            }

            // Water Treatment Systems
            if (preferences.waterTreatment.includes('water-softener')) {
                tasks.push({
                    id: taskId++,
                    title: 'Add Water Softener Salt',
                    category: 'Water Systems',
                    frequency: Math.round(60 * occupancyModifier),
                    priority: 'medium',
                    cost: 20,
                    description: 'Check and refill water softener salt reservoir',
                    tips: 'Use high-quality salt, clean brine tank annually',
                    lastCompleted: null,
                    nextDue: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000)
                });
            }

            if (preferences.waterTreatment.includes('filtration')) {
                tasks.push({
                    id: taskId++,
                    title: 'Replace Water Filter',
                    category: 'Water Systems',
                    frequency: Math.round(180 * occupancyModifier),
                    priority: 'medium',
                    cost: 50,
                    description: 'Replace whole-house or under-sink water filter',
                    tips: 'Monitor water pressure drop as indicator for replacement',
                    lastCompleted: null,
                    nextDue: new Date(Date.now() + 45 * 24 * 60 * 60 * 1000)
                });
            }

            if (preferences.waterTreatment.includes('reverse-osmosis')) {
                tasks.push({
                    id: taskId++,
                    title: 'Service RO System',
                    category: 'Water Systems',
                    frequency: Math.round(365 * frequencyModifier),
                    priority: 'medium',
                    cost: 100,
                    description: 'Replace RO filters and membrane, sanitize system',
                    tips: 'Pre-filter every 6 months, membrane every 2-3 years',
                    lastCompleted: null,
                    nextDue: new Date(Date.now() + 90 * 24 * 60 * 60 * 1000)
                });
            }

            // General Home Tasks
            tasks.push({
                id: taskId++,
                title: 'Clean Gutters and Downspouts',
                category: 'Exterior',
                frequency: Math.round(182 * frequencyModifier), // twice yearly
                priority: 'medium',
                cost: 150,
                description: 'Remove debris from gutters and check downspouts for proper drainage',
                tips: 'Schedule for spring and fall, install gutter guards to reduce frequency',
                lastCompleted: null,
                nextDue: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000)
            });

            tasks.push({
                id: taskId++,
                title: 'Test Smoke and CO Detectors',
                category: 'Safety',
                frequency: Math.round(30 * frequencyModifier),
                priority: 'high',
                cost: 0,
                description: 'Test all smoke and carbon monoxide detectors, replace batteries',
                tips: 'Test monthly, replace batteries annually or when chirping',
                lastCompleted: null,
                nextDue: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000)
            });

            tasks.push({
                id: taskId++,
                title: 'Inspect and Test GFCI Outlets',
                category: 'Electrical',
                frequency: Math.round(90 * frequencyModifier),
                priority: 'medium',
                cost: 0,
                description: 'Test GFCI outlets in bathrooms, kitchen, and outdoor areas',
                tips: 'Press test and reset buttons, replace if not working properly',
                lastCompleted: null,
                nextDue: new Date(Date.now() + 21 * 24 * 60 * 60 * 1000)
            });

            // Feature-specific tasks
            if (preferences.features.includes('fireplace')) {
                tasks.push({
                    id: taskId++,
                    title: 'Chimney Inspection and Cleaning',
                    category: 'Safety',
                    frequency: Math.round(365 * frequencyModifier),
                    priority: 'high',
                    cost: 300,
                    description: 'Professional chimney inspection and cleaning',
                    tips: 'Required annually for safety and insurance compliance',
                    lastCompleted: null,
                    nextDue: new Date(Date.now() + 75 * 24 * 60 * 60 * 1000)
                });
            }

            if (preferences.features.includes('deck')) {
                tasks.push({
                    id: taskId++,
                    title: 'Deck Staining and Sealing',
                    category: 'Exterior',
                    frequency: Math.round(730 * frequencyModifier), // 2 years
                    priority: 'medium',
                    cost: 200,
                    description: 'Clean and apply protective stain or sealant to deck',
                    tips: 'Best done in dry weather, spring or early fall',
                    lastCompleted: null,
                    nextDue: new Date(Date.now() + 180 * 24 * 60 * 60 * 1000)
                });
            }

            if (preferences.features.includes('pool')) {
                tasks.push({
                    id: taskId++,
                    title: 'Pool Opening/Closing',
                    category: 'Pool & Spa',
                    frequency: Math.round(182 * frequencyModifier),
                    priority: 'medium',
                    cost: 250,
                    description: 'Seasonal pool opening and closing service',
                    tips: 'Schedule based on local climate and usage patterns',
                    lastCompleted: null,
                    nextDue: new Date(Date.now() + 120 * 24 * 60 * 60 * 1000)
                });

                tasks.push({
                    id: taskId++,
                    title: 'Pool Equipment Service',
                    category: 'Pool & Spa',
                    frequency: Math.round(365 * frequencyModifier),
                    priority: 'medium',
                    cost: 150,
                    description: 'Professional pool pump, filter, and heater maintenance',
                    tips: 'Check before swimming season, replace filters as needed',
                    lastCompleted: null,
                    nextDue: new Date(Date.now() + 90 * 24 * 60 * 60 * 1000)
                });
            }

            if (preferences.features.includes('garage')) {
                tasks.push({
                    id: taskId++,
                    title: 'Garage Door Maintenance',
                    category: 'Mechanical',
                    frequency: Math.round(365 * frequencyModifier),
                    priority: 'medium',
                    cost: 100,
                    description: 'Lubricate garage door hardware and test safety features',
                    tips: 'Check door balance, test auto-reverse safety mechanism',
                    lastCompleted: null,
                    nextDue: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000)
                });
            }

            if (preferences.features.includes('security')) {
                tasks.push({
                    id: taskId++,
                    title: 'Security System Test',
                    category: 'Safety',
                    frequency: Math.round(90 * frequencyModifier),
                    priority: 'medium',
                    cost: 0,
                    description: 'Test security system sensors, cameras, and backup power',
                    tips: 'Check battery backup, clean camera lenses, test all zones',
                    lastCompleted: null,
                    nextDue: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000)
                });
            }

            if (preferences.features.includes('solar')) {
                tasks.push({
                    id: taskId++,
                    title: 'Solar Panel Cleaning',
                    category: 'Energy Systems',
                    frequency: Math.round(182 * frequencyModifier),
                    priority: 'medium',
                    cost: 100,
                    description: 'Clean solar panels and check system performance',
                    tips: 'Clean more frequently in dusty areas, check for shading issues',
                    lastCompleted: null,
                    nextDue: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000)
                });
            }

            // Age-based tasks
            const homeAge = new Date().getFullYear() - property.yearBuilt;
            
            if (homeAge > 10) {
                tasks.push({
                    id: taskId++,
                    title: 'Caulk and Weatherstrip Inspection',
                    category: 'Energy Efficiency',
                    frequency: Math.round(365 * frequencyModifier),
                    priority: 'medium',
                    cost: 50,
                    description: 'Inspect and replace caulk around windows, doors, and bathrooms',
                    tips: 'Look for cracks, gaps, or peeling - replace as needed',
                    lastCompleted: null,
                    nextDue: new Date(Date.now() + 45 * 24 * 60 * 60 * 1000)
                });
            }

            if (homeAge > 15) {
                tasks.push({
                    id: taskId++,
                    title: 'Electrical Panel Inspection',
                    category: 'Electrical',
                    frequency: Math.round(1825 * frequencyModifier), // 5 years
                    priority: 'medium',
                    cost: 300,
                    description: 'Professional electrical panel and wiring inspection',
                    tips: 'Recommended for homes over 15 years old',
                    lastCompleted: null,
                    nextDue: new Date(Date.now() + 200 * 24 * 60 * 60 * 1000)
                });
            }

            if (homeAge > 20) {
                tasks.push({
                    id: taskId++,
                    title: 'Roof Inspection',
                    category: 'Exterior',
                    frequency: Math.round(1095 * frequencyModifier), // 3 years
                    priority: 'high',
                    cost: 250,
                    description: 'Professional roof inspection for damage and wear',
                    tips: 'Critical for older homes to prevent water damage',
                    lastCompleted: null,
                    nextDue: new Date(Date.now() + 150 * 24 * 60 * 60 * 1000)
                });

                tasks.push({
                    id: taskId++,
                    title: 'Plumbing System Inspection',
                    category: 'Plumbing',
                    frequency: Math.round(1825 * frequencyModifier), // 5 years
                    priority: 'medium',
                    cost: 200,
                    description: 'Professional plumbing inspection for leaks and wear',
                    tips: 'Check water pressure, inspect pipes for corrosion',
                    lastCompleted: null,
                    nextDue: new Date(Date.now() + 240 * 24 * 60 * 60 * 1000)
                });
            }

            if (homeAge > 30) {
                tasks.push({
                    id: taskId++,
                    title: 'Foundation Inspection',
                    category: 'Structural',
                    frequency: Math.round(1825 * frequencyModifier), // 5 years
                    priority: 'high',
                    cost: 400,
                    description: 'Professional foundation and structural inspection',
                    tips: 'Look for settling, cracks, or moisture issues',
                    lastCompleted: null,
                    nextDue: new Date(Date.now() + 300 * 24 * 60 * 60 * 1000)
                });
            }

            return tasks;
        }

        // Main app functions
        function initializeMainApp() {
            document.getElementById('dashboard-address').textContent = `Managing maintenance for ${propertyData.address}`;
            document.getElementById('api-mode-indicator').textContent = demoMode ? 'Smart Demo Mode' : 'Live Property Data';
            document.getElementById('current-api-status').textContent = demoMode ? 'Smart Demo Mode' : 'Live Property Data';
            
            updateTaskStats();
            renderUpcomingTasks();
            renderAllTasks();
            renderCalendarView();
            renderPropertySummary();
            renderAppliances();
            updateApplianceStats();
            renderServiceHistory();
            renderServiceProviders();
            updateDocumentationStats();
        }

        function updateTaskStats() {
            const now = new Date();
            const oneWeek = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);
            
            const overdue = maintenanceTasks.filter(task => new Date(task.nextDue) < now).length;
            const thisWeek = maintenanceTasks.filter(task => new Date(task.nextDue) <= oneWeek && new Date(task.nextDue) >= now).length;
            const total = maintenanceTasks.length;
            const annualCost = maintenanceTasks.reduce((sum, task) => {
                const yearlyFreq = 365 / task.frequency;
                return sum + (task.cost * yearlyFreq);
            }, 0);

            document.getElementById('overdue-count').textContent = overdue;
            document.getElementById('week-count').textContent = thisWeek;
            document.getElementById('total-count').textContent = total;
            document.getElementById('annual-cost').textContent = `${Math.round(annualCost)}`;
        }

        function renderUpcomingTasks() {
            const container = document.getElementById('upcoming-tasks-list');
            const now = new Date();
            const twoWeeks = new Date(now.getTime() + 14 * 24 * 60 * 60 * 1000);
            
            const upcoming = maintenanceTasks
                .filter(task => new Date(task.nextDue) <= twoWeeks)
                .sort((a, b) => new Date(a.nextDue) - new Date(b.nextDue))
                .slice(0, 5);

            if (upcoming.length === 0) {
                container.innerHTML = `
                    <div class="p-8 text-center text-gray-500">
                        <div class="text-4xl mb-4">‚úÖ</div>
                        <p class="font-medium">All caught up!</p>
                        <p class="text-sm">No urgent maintenance tasks in the next two weeks.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = upcoming.map(task => {
                const daysUntil = Math.ceil((new Date(task.nextDue) - now) / (1000 * 60 * 60 * 24));
                const isOverdue = daysUntil < 0;
                const urgencyClass = isOverdue ? 'border-l-red-500 bg-red-50' : 
                                   daysUntil <= 3 ? 'border-l-orange-500 bg-orange-50' : 
                                   'border-l-blue-500 bg-blue-50';
                
                return `
                    <div class="p-6 border-l-4 ${urgencyClass} hover:bg-opacity-75 transition-colors">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <h4 class="font-semibold text-gray-900 mb-1">${task.title}</h4>
                                <p class="text-sm text-gray-600 mb-2">${task.category} ‚Ä¢ ${task.description}</p>
                                <div class="flex items-center gap-4 text-xs text-gray-500">
                                    <span>Due: ${new Date(task.nextDue).toLocaleDateString()}</span>
                                    ${task.cost > 0 ? `<span>Est. Cost: ${task.cost}</span>` : '<span>DIY Task</span>'}
                                    <span class="font-medium ${isOverdue ? 'text-red-600' : daysUntil <= 3 ? 'text-orange-600' : 'text-blue-600'}">
                                        ${isOverdue ? `${Math.abs(daysUntil)} days overdue` : daysUntil === 0 ? 'Due today' : `${daysUntil} days`}
                                    </span>
                                </div>
                                ${task.tips ? `<p class="text-xs text-blue-600 mt-2">üí° ${task.tips}</p>` : ''}
                            </div>
                            <div class="flex gap-2 ml-4">
                                <button onclick="completeTask(${task.id})" class="px-4 py-2 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 transition-colors">
                                    Complete
                                </button>
                                <button onclick="postponeTask(${task.id})" class="px-4 py-2 bg-gray-200 text-gray-700 text-sm rounded-lg hover:bg-gray-300 transition-colors">
                                    Postpone
                                </button>
                            </div>
                        </div>
                    </div>
                `;
        function renderAllTasks() {
            const container = document.getElementById('all-tasks-list');
            const tasksByCategory = {};
            
            maintenanceTasks.forEach(task => {
                if (!tasksByCategory[task.category]) {
                    tasksByCategory[task.category] = [];
                }
                tasksByCategory[task.category].push(task);
            });

            container.innerHTML = Object.entries(tasksByCategory).map(([category, tasks]) => `
                <div class="border-b border-gray-100 last:border-b-0">
                    <div class="p-6 bg-gray-50">
                        <h4 class="font-semibold text-gray-900">${category} (${tasks.length} tasks)</h4>
                    </div>
                    ${tasks.map(task => {
                        const now = new Date();
                        const daysUntil = Math.ceil((new Date(task.nextDue) - now) / (1000 * 60 * 60 * 24));
                        const isOverdue = daysUntil < 0;
                        
                        return `
                            <div class="p-6 border-b border-gray-100 last:border-b-0 hover:bg-gray-50 transition-colors">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h5 class="font-medium text-gray-900 mb-1">${task.title}</h5>
                                        <p class="text-sm text-gray-600 mb-2">${task.description}</p>
                                        <div class="flex items-center gap-4 text-xs text-gray-500">
                                            <span>Every ${Math.round(task.frequency / 30)} months</span>
                                            <span>Next: ${new Date(task.nextDue).toLocaleDateString()}</span>
                                            ${task.cost > 0 ? `<span>${task.cost}</span>` : '<span>DIY</span>'}
                                            <span class="font-medium ${isOverdue ? 'text-red-600' : daysUntil <= 7 ? 'text-orange-600' : 'text-gray-500'}">
                                                ${isOverdue ? 'Overdue' : daysUntil <= 7 ? 'Due soon' : 'Scheduled'}
                                            </span>
                                        </div>
                                        ${task.tips ? `<p class="text-xs text-blue-600 mt-2">üí° ${task.tips}</p>` : ''}
                                    </div>
                                    <div class="flex gap-2 ml-4">
                                        <button onclick="completeTask(${task.id})" class="px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700 transition-colors">
                                            Complete
                                        </button>
                                        <button onclick="editTask(${task.id})" class="px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors">
                                            Edit
                                        </button>
                                        <button onclick="deleteTask(${task.id})" class="px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700 transition-colors">
                                            Delete
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `).join('');
        }

        function renderCalendarView() {
            const container = document.getElementById('calendar-view');
            const now = new Date();
            const months = [];
            
            // Generate next 6 months
            for (let i = 0; i < 6; i++) {
                const month = new Date(now.getFullYear(), now.getMonth() + i, 1);
                const monthEnd = new Date(now.getFullYear(), now.getMonth() + i + 1, 0);
                
                const monthTasks = maintenanceTasks.filter(task => {
                    const taskDate = new Date(task.nextDue);
                    return taskDate >= month && taskDate <= monthEnd;
                }).sort((a, b) => new Date(a.nextDue) - new Date(b.nextDue));
                
                months.push({
                    name: month.toLocaleDateString('en-US', { month: 'long', year: 'numeric' }),
                    tasks: monthTasks
                });
            }

            container.innerHTML = months.map(month => `
                <div class="bg-gray-50 rounded-lg p-6">
                    <h4 class="font-semibold text-gray-900 mb-4">${month.name} (${month.tasks.length} tasks)</h4>
                    ${month.tasks.length === 0 ? 
                        '<p class="text-gray-500 text-sm">No tasks scheduled</p>' :
                        month.tasks.map(task => `
                            <div class="bg-white rounded p-3 mb-2 border-l-4 border-blue-500">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h5 class="font-medium text-sm">${task.title}</h5>
                                        <p class="text-xs text-gray-600">${task.category}</p>
                                    </div>
                                    <span class="text-xs text-gray-500">${new Date(task.nextDue).toLocaleDateString()}</span>
                                </div>
                            </div>
                        `).join('')
                    }
                </div>
            `).join('');
        }

        function renderPropertySummary() {
            const container = document.getElementById('property-summary');
            const systems = [];
            
            if (userPreferences.hvacSystems?.length > 0) {
                systems.push(`HVAC: ${userPreferences.hvacSystems.join(', ')}`);
            }
            if (userPreferences.waterSource) {
                systems.push(`Water: ${userPreferences.waterSource === 'well' ? 'Well Water' : 'City Water'}`);
            }
            if (userPreferences.sewerType) {
                systems.push(`Sewer: ${userPreferences.sewerType === 'septic' ? 'Septic System' : 'Public Sewer'}`);
            }
            if (userPreferences.features?.length > 0) {
                systems.push(`Features: ${userPreferences.features.join(', ')}`);
            }

            container.innerHTML = `
                <div class="space-y-2">
                    <p><strong>Address:</strong> ${propertyData.address}</p>
                    <p><strong>Built:</strong> ${propertyData.yearBuilt} ‚Ä¢ <strong>Size:</strong> ${propertyData.squareFootage} sq ft</p>
                    <p><strong>Bedrooms:</strong> ${propertyData.bedrooms} ‚Ä¢ <strong>Bathrooms:</strong> ${propertyData.bathrooms}</p>
                    <p><strong>Occupancy:</strong> ${userPreferences.occupancy} people ‚Ä¢ <strong>Pets:</strong> ${userPreferences.pets === 'yes' ? 'Yes' : 'No'}</p>
                    <p><strong>Approach:</strong> ${userPreferences.approach}</p>
                    ${systems.length > 0 ? `<p><strong>Systems:</strong> ${systems.join(' ‚Ä¢ ')}</p>` : ''}
                </div>
            `;
        }

        // Task management functions
        function completeTask(taskId) {
            const task = maintenanceTasks.find(t => t.id === taskId);
            openModal('Complete Task', `
                <p class="mb-4">Mark "${task.title}" as completed?</p>
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Completion Date</label>
                        <input type="date" id="completion-date" value="${new Date().toISOString().split('T')[0]}" 
                               class="w-full px-3 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Notes (optional)</label>
                        <textarea id="completion-notes" placeholder="Any notes about this maintenance..." 
                                  class="w-full px-3 py-2 border rounded-lg" rows="2"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Actual Cost</label>
                        <input type="number" id="actual-cost" value="${task.cost}" 
                               class="w-full px-3 py-2 border rounded-lg" placeholder="0">
                    </div>
                </div>
            `, () => {
                const completionDate = new Date(document.getElementById('completion-date').value);
                const notes = document.getElementById('completion-notes').value;
                const actualCost = parseFloat(document.getElementById('actual-cost').value) || 0;
                
                // Update task
                task.lastCompleted = completionDate;
                task.nextDue = new Date(completionDate.getTime() + task.frequency * 24 * 60 * 60 * 1000);
                task.actualCost = actualCost;
                task.notes = notes;
                
                saveData();
                refreshApp();
                closeModal();
            });
        }

        function postponeTask(taskId) {
            const task = maintenanceTasks.find(t => t.id === taskId);
            openModal('Postpone Task', `
                <p class="mb-4">Postpone "${task.title}" until when?</p>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">New Due Date</label>
                    <input type="date" id="postpone-date" 
                           value="${new Date(new Date(task.nextDue).getTime() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]}" 
                           class="w-full px-3 py-2 border rounded-lg">
                </div>
            `, () => {
                const newDate = new Date(document.getElementById('postpone-date').value);
                task.nextDue = newDate;
                
                saveData();
                refreshApp();
                closeModal();
            });
        }

        function editTask(taskId) {
            const task = maintenanceTasks.find(t => t.id === taskId);
            openModal('Edit Task', `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Task Title</label>
                        <input type="text" id="edit-title" value="${task.title}" 
                               class="w-full px-3 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                        <select id="edit-category" class="w-full px-3 py-2 border rounded-lg">
                            <option value="HVAC" ${task.category === 'HVAC' ? 'selected' : ''}>HVAC</option>
                            <option value="Water Systems" ${task.category === 'Water Systems' ? 'selected' : ''}>Water Systems</option>
                            <option value="Exterior" ${task.category === 'Exterior' ? 'selected' : ''}>Exterior</option>
                            <option value="Safety" ${task.category === 'Safety' ? 'selected' : ''}>Safety</option>
                            <option value="Electrical" ${task.category === 'Electrical' ? 'selected' : ''}>Electrical</option>
                            <option value="Pool & Spa" ${task.category === 'Pool & Spa' ? 'selected' : ''}>Pool & Spa</option>
                            <option value="General" ${task.category === 'General' ? 'selected' : ''}>General</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                        <textarea id="edit-description" class="w-full px-3 py-2 border rounded-lg" rows="2">${task.description}</textarea>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Frequency (days)</label>
                            <input type="number" id="edit-frequency" value="${task.frequency}" 
                                   class="w-full px-3 py-2 border rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Estimated Cost</label>
                            <input type="number" id="edit-cost" value="${task.cost}" 
                                   class="w-full px-3 py-2 border rounded-lg">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tips</label>
                        <textarea id="edit-tips" class="w-full px-3 py-2 border rounded-lg" rows="2">${task.tips || ''}</textarea>
                    </div>
                </div>
            `, () => {
                task.title = document.getElementById('edit-title').value;
                task.category = document.getElementById('edit-category').value;
                task.description = document.getElementById('edit-description').value;
                task.frequency = parseInt(document.getElementById('edit-frequency').value);
                task.cost = parseFloat(document.getElementById('edit-cost').value) || 0;
                task.tips = document.getElementById('edit-tips').value;
                
                saveData();
                refreshApp();
                closeModal();
            });
        }

        function deleteTask(taskId) {
            const task = maintenanceTasks.find(t => t.id === taskId);
            if (confirm(`Are you sure you want to delete "${task.title}"? This cannot be undone.`)) {
                maintenanceTasks = maintenanceTasks.filter(t => t.id !== taskId);
                saveData();
                refreshApp();
            }
        }

        function addCustomTask() {
            openModal('Add Custom Task', `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Task Title</label>
                        <input type="text" id="custom-title" placeholder="e.g., Clean gutters" 
                               class="w-full px-3 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                        <select id="custom-category" class="w-full px-3 py-2 border rounded-lg">
                            <option value="General">General</option>
                            <option value="HVAC">HVAC</option>
                            <option value="Water Systems">Water Systems</option>
                            <option value="Exterior">Exterior</option>
                            <option value="Safety">Safety</option>
                            <option value="Electrical">Electrical</option>
                            <option value="Pool & Spa">Pool & Spa</option>
                            <option value="Mechanical">Mechanical</option>
                            <option value="Energy Systems">Energy Systems</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                        <textarea id="custom-description" placeholder="What needs to be done?" 
                                  class="w-full px-3 py-2 border rounded-lg" rows="2"></textarea>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Frequency (days)</label>
                            <input type="number" id="custom-frequency" value="365" 
                                   class="w-full px-3 py-2 border rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Estimated Cost</label>
                            <input type="number" id="custom-cost" value="0" 
                                   class="w-full px-3 py-2 border rounded-lg">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Next Due Date</label>
                        <input type="date" id="custom-due" 
                               value="${new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]}" 
                               class="w-full px-3 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tips (optional)</label>
                        <textarea id="custom-tips" placeholder="Helpful maintenance tips..." 
                                  class="w-full px-3 py-2 border rounded-lg" rows="2"></textarea>
                    </div>
                </div>
            `, () => {
                const title = document.getElementById('custom-title').value.trim();
                if (!title) {
                    alert('Please enter a task title');
                    return;
                }
                
                const newTask = {
                    id: Math.max(...maintenanceTasks.map(t => t.id), 0) + 1,
                    title: title,
                    category: document.getElementById('custom-category').value,
                    description: document.getElementById('custom-description').value,
                    frequency: parseInt(document.getElementById('custom-frequency').value),
                    cost: parseFloat(document.getElementById('custom-cost').value) || 0,
                    priority: 'medium',
                    tips: document.getElementById('custom-tips').value,
                    lastCompleted: null,
                    nextDue: new Date(document.getElementById('custom-due').value)
                };
                
                maintenanceTasks.push(newTask);
                saveData();
                refreshApp();
                closeModal();
            });
        }

        // Appliance management functions
        function addAppliance() {
            currentEditingAppliance = null;
            document.getElementById('appliance-modal-title').textContent = 'Add Appliance';
            clearApplianceForm();
            document.getElementById('appliance-modal').classList.remove('hidden');
        }

        function editAppliance(applianceId) {
            const appliance = appliances.find(a => a.id === applianceId);
            if (appliance) {
                currentEditingAppliance = appliance;
                document.getElementById('appliance-modal-title').textContent = 'Edit Appliance';
                populateApplianceForm(appliance);
                document.getElementById('appliance-modal').classList.remove('hidden');
            }
        }

        function clearApplianceForm() {
            document.getElementById('appliance-type').value = '';
            document.getElementById('appliance-brand').value = '';
            document.getElementById('appliance-model').value = '';
            document.getElementById('appliance-purchase-date').value = '';
            document.getElementById('appliance-warranty').value = '';
            document.getElementById('appliance-location').value = '';
            document.getElementById('appliance-serial').value = '';
            document.getElementById('appliance-notes').value = '';
        }

        function populateApplianceForm(appliance) {
            document.getElementById('appliance-type').value = appliance.type;
            document.getElementById('appliance-brand').value = appliance.brand;
            document.getElementById('appliance-model').value = appliance.model;
            document.getElementById('appliance-purchase-date').value = appliance.purchaseDate;
            document.getElementById('appliance-warranty').value = appliance.warrantyYears;
            document.getElementById('appliance-location').value = appliance.location;
            document.getElementById('appliance-serial').value = appliance.serialNumber || '';
            document.getElementById('appliance-notes').value = appliance.notes || '';
        }

        function saveAppliance() {
            const type = document.getElementById('appliance-type').value;
            const brand = document.getElementById('appliance-brand').value;
            const model = document.getElementById('appliance-model').value;
            
            if (!type || !brand || !model) {
                alert('Please fill in at least the type, brand, and model');
                return;
            }

            const applianceData = {
                id: currentEditingAppliance ? currentEditingAppliance.id : Math.max(...appliances.map(a => a.id), 0) + 1,
                type: type,
                brand: brand,
                model: model,
                purchaseDate: document.getElementById('appliance-purchase-date').value,
                warrantyYears: parseInt(document.getElementById('appliance-warranty').value) || 0,
                location: document.getElementById('appliance-location').value,
                serialNumber: document.getElementById('appliance-serial').value,
                notes: document.getElementById('appliance-notes').value,
                lastServiceDate: currentEditingAppliance ? currentEditingAppliance.lastServiceDate : null
            };

            if (currentEditingAppliance) {
                const index = appliances.findIndex(a => a.id === currentEditingAppliance.id);
                appliances[index] = applianceData;
            } else {
                appliances.push(applianceData);
                generateApplianceMaintenanceTasks(applianceData);
            }

            closeApplianceModal();
            renderAppliances();
            updateApplianceStats();
            saveData();
        }

        function generateApplianceMaintenanceTasks(appliance) {
            const taskTemplates = {
                'Water Heater': [
                    { title: `Flush ${appliance.brand} Water Heater`, frequency: 365, cost: 50, description: 'Drain and flush water heater tank' },
                    { title: `Test ${appliance.brand} Water Heater Relief Valve`, frequency: 180, cost: 0, description: 'Test pressure relief valve operation' }
                ],
                'Refrigerator': [
                    { title: `Clean ${appliance.brand} Refrigerator Coils`, frequency: 180, cost: 0, description: 'Clean condenser coils for efficiency' },
                    { title: `Replace ${appliance.brand} Water Filter`, frequency: 180, cost: 30, description: 'Replace water/ice filter cartridge' }
                ],
                'Dishwasher': [
                    { title: `Descale ${appliance.brand} Dishwasher`, frequency: 90, cost: 10, description: 'Run descaling cycle with appropriate cleaner' },
                    { title: `Clean ${appliance.brand} Dishwasher Filter`, frequency: 30, cost: 0, description: 'Remove and clean bottom dishwasher filter' }
                ],
                'Washer': [
                    { title: `Clean ${appliance.brand} Washer`, frequency: 90, cost: 5, description: 'Run cleaning cycle and wipe down seals' },
                    { title: `Check ${appliance.brand} Washer Hoses`, frequency: 365, cost: 0, description: 'Inspect hoses for cracks or bulges' }
                ],
                'Dryer': [
                    { title: `Clean ${appliance.brand} Dryer Vent`, frequency: 365, cost: 100, description: 'Professional dryer vent cleaning' },
                    { title: `Clean ${appliance.brand} Lint Filter`, frequency: 1, cost: 0, description: 'Clean lint filter after each use' }
                ]
            };

            const templates = taskTemplates[appliance.type];
            if (templates) {
                templates.forEach(template => {
                    const newTask = {
                        id: Math.max(...maintenanceTasks.map(t => t.id), 0) + 1,
                        title: template.title,
                        category: 'Appliances',
                        frequency: template.frequency,
                        priority: 'medium',
                        cost: template.cost,
                        description: template.description,
                        tips: `Specific to ${appliance.brand} ${appliance.model}`,
                        lastCompleted: null,
                        nextDue: new Date(Date.now() + template.frequency * 24 * 60 * 60 * 1000),
                        applianceId: appliance.id
                    };
                    maintenanceTasks.push(newTask);
                });
            }
        }

        function deleteAppliance(applianceId) {
            const appliance = appliances.find(a => a.id === applianceId);
            if (appliance && confirm(`Delete ${appliance.brand} ${appliance.type}?`)) {
                appliances = appliances.filter(a => a.id !== applianceId);
                // Remove associated tasks
                maintenanceTasks = maintenanceTasks.filter(t => t.applianceId !== applianceId);
                renderAppliances();
                updateApplianceStats();
                saveData();
            }
        }

        function closeApplianceModal() {
            document.getElementById('appliance-modal').classList.add('hidden');
            currentEditingAppliance = null;
        }

        function renderAppliances() {
            const container = document.getElementById('appliances-list');
            
            if (appliances.length === 0) {
                container.innerHTML = `
                    <div class="p-8 text-center text-gray-500">
                        <div class="text-4xl mb-4">üîß</div>
                        <p class="font-medium">No appliances added yet</p>
                        <p class="text-sm">Add your first appliance to start tracking maintenance</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = appliances.map(appliance => {
                const age = appliance.purchaseDate ? 
                    Math.floor((new Date() - new Date(appliance.purchaseDate)) / (365.25 * 24 * 60 * 60 * 1000)) : 
                    'Unknown';
                const warrantyExpires = appliance.purchaseDate && appliance.warrantyYears ? 
                    new Date(new Date(appliance.purchaseDate).getTime() + appliance.warrantyYears * 365.25 * 24 * 60 * 60 * 1000) : 
                    null;
                const underWarranty = warrantyExpires && warrantyExpires > new Date();
                
                return `
                    <div class="p-6 border-b border-gray-100 last:border-b-0 hover:bg-gray-50 transition-colors">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <h4 class="font-semibold text-gray-900 mb-1">${appliance.brand} ${appliance.type}</h4>
                                <p class="text-sm text-gray-600 mb-2">Model: ${appliance.model} ‚Ä¢ Location: ${appliance.location}</p>
                                <div class="flex items-center gap-4 text-xs text-gray-500">
                                    <span>Age: ${age} ${age !== 'Unknown' ? 'years' : ''}</span>
                                    ${underWarranty ? 
                                        `<span class="bg-green-100 text-green-800 px-2 py-1 rounded">Under Warranty</span>` :
                                        '<span class="bg-gray-100 text-gray-600 px-2 py-1 rounded">Out of Warranty</span>'
                                    }
                                    <button onclick="findParts(${appliance.id})" class="text-blue-600 hover:text-blue-800">Find Parts</button>
                                </div>
                                ${appliance.notes ? `<p class="text-xs text-gray-600 mt-1">Notes: ${appliance.notes}</p>` : ''}
                            </div>
                            <div class="flex gap-2 ml-4">
                                <button onclick="editAppliance(${appliance.id})" class="px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700">
                                    Edit
                                </button>
                                <button onclick="deleteAppliance(${appliance.id})" class="px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700">
                                    Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateApplianceStats() {
            const now = new Date();
            const underWarranty = appliances.filter(a => {
                if (!a.purchaseDate || !a.warrantyYears) return false;
                const warrantyExpires = new Date(new Date(a.purchaseDate).getTime() + a.warrantyYears * 365.25 * 24 * 60 * 60 * 1000);
                return warrantyExpires > now;
            }).length;

            const avgAge = appliances.length > 0 ? 
                appliances.filter(a => a.purchaseDate).reduce((sum, a) => {
                    const age = Math.floor((now - new Date(a.purchaseDate)) / (365.25 * 24 * 60 * 60 * 1000));
                    return sum + age;
                }, 0) / appliances.filter(a => a.purchaseDate).length : 0;

            document.getElementById('total-appliances').textContent = appliances.length;
            document.getElementById('warranty-count').textContent = underWarranty;
            document.getElementById('service-needed').textContent = '0'; // TODO: Calculate from overdue tasks
            document.getElementById('avg-age').textContent = avgAge > 0 ? `${Math.round(avgAge)} years` : '0 years';
        }

        function findParts(applianceId) {
            const appliance = appliances.find(a => a.id === applianceId);
            if (appliance) {
                const searchQuery = `${appliance.brand} ${appliance.model} replacement parts`;
                const url = `https://www.google.com/search?q=${encodeURIComponent(searchQuery)}`;
                window.open(url, '_blank');
            }
        }

        // Service provider management
        function addServiceProvider() {
            currentEditingProvider = null;
            document.getElementById('provider-modal-title').textContent = 'Add Service Provider';
            clearProviderForm();
            document.getElementById('provider-modal').classList.remove('hidden');
        }

        function editServiceProvider(providerId) {
            const provider = serviceProviders.find(p => p.id === providerId);
            if (provider) {
                currentEditingProvider = provider;
                document.getElementById('provider-modal-title').textContent = 'Edit Service Provider';
                populateProviderForm(provider);
                document.getElementById('provider-modal').classList.remove('hidden');
            }
        }

        function clearProviderForm() {
            document.getElementById('provider-name').value = '';
            document.getElementById('provider-type').value = 'HVAC';
            document.getElementById('provider-phone').value = '';
            document.getElementById('provider-rating').value = '5';
            document.getElementById('provider-email').value = '';
            document.getElementById('provider-notes').value = '';
        }

        function populateProviderForm(provider) {
            document.getElementById('provider-name').value = provider.name;
            document.getElementById('provider-type').value = provider.type;
            document.getElementById('provider-phone').value = provider.phone;
            document.getElementById('provider-rating').value = provider.rating;
            document.getElementById('provider-email').value = provider.email || '';
            document.getElementById('provider-notes').value = provider.notes || '';
        }

        function saveServiceProvider() {
            const name = document.getElementById('provider-name').value.trim();
            const phone = document.getElementById('provider-phone').value.trim();
            
            if (!name || !phone) {
                alert('Please enter at least the company name and phone number');
                return;
            }

            const providerData = {
                id: currentEditingProvider ? currentEditingProvider.id : Math.max(...serviceProviders.map(p => p.id), 0) + 1,
                name: name,
                type: document.getElementById('provider-type').value,
                phone: phone,
                rating: parseInt(document.getElementById('provider-rating').value),
                email: document.getElementById('provider-email').value,
                notes: document.getElementById('provider-notes').value,
                dateAdded: currentEditingProvider ? currentEditingProvider.dateAdded : new Date().toISOString()
            };

            if (currentEditingProvider) {
                const index = serviceProviders.findIndex(p => p.id === currentEditingProvider.id);
                serviceProviders[index] = providerData;
            } else {
                serviceProviders.push(providerData);
            }

            closeProviderModal();
            renderServiceProviders();
            updateDocumentationStats();
            saveData();
        }

        function deleteServiceProvider(providerId) {
            const provider = serviceProviders.find(p => p.id === providerId);
            if (provider && confirm(`Delete ${provider.name}?`)) {
                serviceProviders = serviceProviders.filter(p => p.id !== providerId);
                renderServiceProviders();
                updateDocumentationStats();
                saveData();
            }
        }

        function closeProviderModal() {
            document.getElementById('provider-modal').classList.add('hidden');
            currentEditingProvider = null;
        }

        function renderServiceProviders() {
            const container = document.getElementById('service-providers-list');
            
            if (serviceProviders.length === 0) {
                container.innerHTML = `
                    <div class="p-8 text-center text-gray-500">
                        <div class="text-4xl mb-4">üë∑</div>
                        <p class="font-medium">No service providers added yet</p>
                        <p class="text-sm">Add your trusted contractors and service companies</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = serviceProviders.map(provider => {
                const stars = '‚≠ê'.repeat(provider.rating);
                
                return `
                    <div class="p-6 border-b border-gray-100 last:border-b-0 hover:bg-gray-50 transition-colors">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <h4 class="font-semibold text-gray-900 mb-1">${provider.name}</h4>
                                <p class="text-sm text-gray-600 mb-2">${provider.type} ‚Ä¢ ${provider.phone}</p>
                                <div class="flex items-center gap-4 text-xs text-gray-500">
                                    <span>Rating: ${stars}</span>
                                    ${provider.email ? `<span>Email: ${provider.email}</span>` : ''}
                                    <a href="tel:${provider.phone}" class="text-blue-600 hover:text-blue-800">Call</a>
                                </div>
                                ${provider.notes ? `<p class="text-xs text-gray-600 mt-1">Notes: ${provider.notes}</p>` : ''}
                            </div>
                            <div class="flex gap-2 ml-4">
                                <button onclick="editServiceProvider(${provider.id})" class="px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700">
                                    Edit
                                </button>
                                <button onclick="deleteServiceProvider(${provider.id})" class="px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700">
                                    Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Calendar export functions
        function exportCalendar() {
            alert('Calendar export feature:\n\n1. Click "Download .ics" to get a calendar file\n2. Import the .ics file into:\n   ‚Ä¢ Google Calendar\n   ‚Ä¢ Outlook\n   ‚Ä¢ Apple Calendar\n   ‚Ä¢ Any calendar app\n\nThis will add all your maintenance tasks as recurring events!');
        }

        function exportICS() {
            let icsContent = [
                'BEGIN:VCALENDAR',
                'VERSION:2.0',
                'PRODID:-//Casa Care//Home Maintenance//EN',
                'CALSCALE:GREGORIAN'
            ];

            maintenanceTasks.forEach(task => {
                const startDate = new Date(task.nextDue);
                const endDate = new Date(startDate.getTime() + 60 * 60 * 1000); // 1 hour duration
                
                const formatDate = (date) => {
                    return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
                };

                icsContent.push(
                    'BEGIN:VEVENT',
                    `UID:${task.id}@casacare.local`,
                    `DTSTART:${formatDate(startDate)}`,
                    `DTEND:${formatDate(endDate)}`,
                    `SUMMARY:${task.title}`,
                    `DESCRIPTION:${task.description}\\n\\nCategory: ${task.category}\\nCost: ${task.cost}${task.tips ? '\\n\\nTips: ' + task.tips : ''}`,
                    `CATEGORIES:${task.category}`,
                    `RRULE:FREQ=DAILY;INTERVAL=${task.frequency}`,
                    'END:VEVENT'
                );
            });

            icsContent.push('END:VCALENDAR');

            const blob = new Blob([icsContent.join('\r\n')], { type: 'text/calendar' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `casa-care-maintenance-schedule.ics`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Documentation functions
        function addServiceRecord() {
            openModal('Add Service Record', `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Service Date</label>
                        <input type="date" id="service-date" value="${new Date().toISOString().split('T')[0]}" 
                               class="w-full px-3 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Service Type</label>
                        <select id="service-type" class="w-full px-3 py-2 border rounded-lg">
                            <option value="Maintenance">Routine Maintenance</option>
                            <option value="Repair">Repair</option>
                            <option value="Installation">Installation</option>
                            <option value="Inspection">Inspection</option>
                            <option value="Cleaning">Cleaning</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                        <textarea id="service-description" placeholder="What was done?" 
                                  class="w-full px-3 py-2 border rounded-lg" rows="3"></textarea>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Cost</label>
                            <input type="number" id="service-cost" placeholder="0" 
                                   class="w-full px-3 py-2 border rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Service Provider</label>
                            <select id="service-provider" class="w-full px-3 py-2 border rounded-lg">
                                <option value="">DIY / Unknown</option>
                                ${serviceProviders.map(p => `<option value="${p.id}">${p.name}</option>`).join('')}
                            </select>
                        </div>
                    </div>
                </div>
            `, () => {
                const serviceRecord = {
                    id: Math.max(...serviceHistory.map(s => s.id), 0) + 1,
                    date: document.getElementById('service-date').value,
                    type: document.getElementById('service-type').value,
                    description: document.getElementById('service-description').value,
                    cost: parseFloat(document.getElementById('service-cost').value) || 0,
                    providerId: document.getElementById('service-provider').value || null,
                    dateAdded: new Date().toISOString()
                };

                serviceHistory.push(serviceRecord);
                renderServiceHistory();
                updateDocumentationStats();
                saveData();
                closeModal();
            });
        }

        function renderServiceHistory() {
            const container = document.getElementById('service-history-list');
            
            if (serviceHistory.length === 0) {
                container.innerHTML = `
                    <div class="p-8 text-center text-gray-500">
                        <div class="text-4xl mb-4">üìã</div>
                        <p class="font-medium">No service records yet</p>
                        <p class="text-sm">Add completed maintenance tasks and service records</p>
                    </div>
                `;
                return;
            }

            const sortedHistory = serviceHistory.sort((a, b) => new Date(b.date) - new Date(a.date));

            container.innerHTML = sortedHistory.map(record => {
                const provider = record.providerId ? serviceProviders.find(p => p.id == record.providerId) : null;
                
                return `
                    <div class="p-6 border-b border-gray-100 last:border-b-0 hover:bg-gray-50 transition-colors">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <h4 class="font-semibold text-gray-900 mb-1">${record.type}</h4>
                                <p class="text-sm text-gray-600 mb-2">${record.description}</p>
                                <div class="flex items-center gap-4 text-xs text-gray-500">
                                    <span>Date: ${new Date(record.date).toLocaleDateString()}</span>
                                    <span>Cost: ${record.cost}</span>
                                    ${provider ? `<span>Provider: ${provider.name}</span>` : '<span>DIY</span>'}
                                </div>
                            </div>
                            <div class="flex gap-2 ml-4">
                                <button onclick="deleteServiceRecord(${record.id})" class="px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700">
                                    Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deleteServiceRecord(recordId) {
            if (confirm('Delete this service record?')) {
                serviceHistory = serviceHistory.filter(s => s.id !== recordId);
                renderServiceHistory();
                updateDocumentationStats();
                saveData();
            }
        }

        function updateDocumentationStats() {
            const completedTasks = maintenanceTasks.filter(t => t.lastCompleted).length;
            const totalSpent = serviceHistory.reduce((sum, record) => sum + record.cost, 0);
            const providersCount = serviceProviders.length;
            const photosCount = 0; // TODO: Implement photo storage

            document.getElementById('completed-tasks-count').textContent = completedTasks;
            document.getElementById('total-spent').textContent = `${Math.round(totalSpent)}`;
            document.getElementById('providers-count').textContent = providersCount;
            document.getElementById('photos-count').textContent = photosCount;
        }

        function exportServiceHistory() {
            const data = serviceHistory.map(record => {
                const provider = record.providerId ? serviceProviders.find(p => p.id == record.providerId) : null;
                return {
                    Date: record.date,
                    Type: record.type,
                    Description: record.description,
                    Cost: record.cost,
                    Provider: provider ? provider.name : 'DIY'
                };
            });

            const csv = [
                ['Date', 'Type', 'Description', 'Cost', 'Provider'],
                ...data.map(row => [row.Date, row.Type, row.Description, row.Cost, row.Provider])
            ].map(row => row.join(',')).join('\n');

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `casa-care-service-history-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function exportWarranties() {
            const data = appliances.filter(a => a.purchaseDate && a.warrantyYears).map(appliance => {
                const purchaseDate = new Date(appliance.purchaseDate);
                const warrantyExpires = new Date(purchaseDate.getTime() + appliance.warrantyYears * 365.25 * 24 * 60 * 60 * 1000);
                return {
                    Type: appliance.type,
                    Brand: appliance.brand,
                    Model: appliance.model,
                    'Purchase Date': appliance.purchaseDate,
                    'Warranty Expires': warrantyExpires.toISOString().split('T')[0],
                    'Serial Number': appliance.serialNumber || 'N/A',
                    Location: appliance.location
                };
            });

            const csv = [
                ['Type', 'Brand', 'Model', 'Purchase Date', 'Warranty Expires', 'Serial Number', 'Location'],
                ...data.map(row => [row.Type, row.Brand, row.Model, row['Purchase Date'], row['Warranty Expires'], row['Serial Number'], row.Location])
            ].map(row => row.join(',')).join('\n');

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `casa-care-warranties-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function viewSpendingReport() {
            const yearlySpending = {};
            serviceHistory.forEach(record => {
                const year = new Date(record.date).getFullYear();
                yearlySpending[year] = (yearlySpending[year] || 0) + record.cost;
            });

            const reportContent = Object.entries(yearlySpending)
                .map(([year, amount]) => `${year}: ${Math.round(amount)}`)
                .join('\n');

            alert(`Annual Spending Report:\n\n${reportContent || 'No spending data available'}`);
        }
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-content').innerHTML = content;
            document.getElementById('modal-confirm').onclick = confirmAction;
            document.getElementById('task-modal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('task-modal').classList.add('hidden');
            currentModalAction = null;
        }

        function confirmTaskAction() {
            // This will be set by the specific action functions
        }

        // App navigation
        function showAppTab(tabName) {
            // Hide all content
            document.querySelectorAll('.app-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.app-tab-btn').forEach(btn => {
                btn.className = 'app-tab-btn text-gray-600 hover:text-gray-900 px-6 py-3 rounded-lg font-medium';
            });
            
            // Show selected content
            document.getElementById(`app-${tabName}`).classList.remove('hidden');
            
            // Style active tab
            document.getElementById(`app-tab-${tabName}`).className = 'app-tab-btn bg-blue-100 text-blue-700 px-6 py-3 rounded-lg font-medium';
            
            // Update content when switching tabs
            if (tabName === 'calendar') {
                renderCalendarView();
            } else if (tabName === 'appliances') {
                renderAppliances();
                updateApplianceStats();
            } else if (tabName === 'documentation') {
                renderServiceHistory();
                renderServiceProviders();
                updateDocumentationStats();
            }
        }

        // Data management
        function saveData() {
            const data = {
                propertyData,
                userPreferences,
                maintenanceTasks,
                appliances,
                serviceProviders,
                serviceHistory,
                setupComplete: true,
                apiKey: apiKey,
                demoMode: demoMode,
                version: '3.0',
                lastSaved: new Date().toISOString()
            };
            localStorage.setItem('casaCareData', JSON.stringify(data));
        }

        function refreshApp() {
            updateTaskStats();
            renderUpcomingTasks();
            renderAllTasks();
            renderCalendarView();
            renderAppliances();
            updateApplianceStats();
            renderServiceHistory();
            renderServiceProviders();
            updateDocumentationStats();
        }

        function exportData() {
            const data = {
                propertyData,
                userPreferences,
                maintenanceTasks: maintenanceTasks.map(task => ({
                    ...task,
                    nextDue: task.nextDue.toISOString(),
                    lastCompleted: task.lastCompleted ? task.lastCompleted.toISOString() : null
                })),
                exportDate: new Date().toISOString(),
                appVersion: '2.0'
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `casa-care-maintenance-plan-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function clearData() {
            if (confirm('Are you sure you want to clear all data? This will delete your entire maintenance plan, appliances, service providers, and service history. This cannot be undone.')) {
                localStorage.removeItem('casaCareData');
                localStorage.removeItem('casaCareApiKey');
                localStorage.removeItem('casaCareDemoMode');
                location.reload();
            }
        }

        function restartWizard() {
            if (confirm('This will clear your current maintenance plan and start over. Continue?')) {
                localStorage.removeItem('casaCareData');
                location.reload();
            }
        }

        // Initialize app
        function initApp() {
            // Check for saved API key and demo mode
            const savedApiKey = localStorage.getItem('casaCareApiKey');
            const savedDemoMode = localStorage.getItem('casaCareDemoMode');
            
            if (savedApiKey) {
                apiKey = savedApiKey;
                demoMode = false;
            } else if (savedDemoMode) {
                demoMode = true;
                apiKey = null;
            }

            // Check for saved app data
            const savedData = localStorage.getItem('casaCareData');
            
            if (savedData && (apiKey || demoMode)) {
                try {
                    const data = JSON.parse(savedData);
                    if (data.setupComplete) {
                        propertyData = data.propertyData;
                        userPreferences = data.userPreferences;
                        maintenanceTasks = data.maintenanceTasks.map(task => ({
                            ...task,
                            nextDue: new Date(task.nextDue),
                            lastCompleted: task.lastCompleted ? new Date(task.lastCompleted) : null
                        }));
                        
                        // Load new data structures (with backwards compatibility)
                        appliances = data.appliances || [];
                        serviceProviders = data.serviceProviders || [];
                        serviceHistory = data.serviceHistory || [];
                        
                        // Update API settings from saved data
                        if (data.apiKey) {
                            apiKey = data.apiKey;
                            demoMode = false;
                        } else if (data.demoMode) {
                            demoMode = true;
                            apiKey = null;
                        }
                        
                        document.getElementById('api-setup').classList.add('hidden');
                        document.getElementById('setup-wizard').classList.add('hidden');
                        document.getElementById('main-app').classList.remove('hidden');
                        initializeMainApp();
                        return;
                    }
                } catch (e) {
                    console.error('Error loading saved data:', e);
                }
            }
            
            if (apiKey || demoMode) {
                // Show setup wizard
                document.getElementById('api-setup').classList.add('hidden');
                document.getElementById('setup-wizard').classList.remove('hidden');
                updateProgressIndicators();
            } else {
                // Show API setup
                document.getElementById('api-setup').classList.remove('hidden');
            }
        }

        // Click outside to close address suggestions
        document.addEventListener('click', function(event) {
            const addressInput = document.getElementById('address-input');
            const suggestions = document.getElementById('address-suggestions');
            
            if (addressInput && suggestions && 
                !addressInput.contains(event.target) && 
                !suggestions.contains(event.target)) {
                hideAddressSuggestions();
            }
        });

        // Start the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
