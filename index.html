<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Casa Care - Home Maintenance</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="app">
        <!-- Header -->
        <div class="bg-white shadow-sm border-b">
            <div class="max-w-4xl mx-auto px-4 py-4">
                <h1 class="text-2xl font-bold text-gray-900">Casa Care</h1>
                <p class="text-gray-600">Smart home maintenance tracker</p>
            </div>
        </div>

        <!-- Setup Form -->
        <div id="setup-form" class="max-w-2xl mx-auto px-4 py-8">
            <div class="bg-white rounded-xl p-8 shadow-lg">
                <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">Tell us about your home</h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Home Address</label>
                        <input type="text" id="address" placeholder="123 Main St, Anytown, NY" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Year Built</label>
                            <input type="number" id="year-built" value="1995" min="1900" max="2024"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Square Footage</label>
                            <input type="number" id="sqft" value="2000" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">What systems do you have?</label>
                        <div class="space-y-2">
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="central-ac" checked>
                                <span>Central Air/Heat</span>
                            </label>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="well-water">
                                <span>Well Water</span>
                            </label>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="septic">
                                <span>Septic System</span>
                            </label>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="fireplace">
                                <span>Fireplace</span>
                            </label>
                        </div>
                    </div>

                    <button onclick="createPlan()" class="w-full bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 font-medium">
                        Create My Maintenance Plan
                    </button>
                </div>
            </div>
        </div>

        <!-- Main App -->
        <div id="main-app" class="hidden max-w-6xl mx-auto px-4 py-8">
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                <div class="p-6 border-b border-gray-100">
                    <h3 class="text-xl font-bold text-gray-900">Your Maintenance Tasks</h3>
                    <p class="text-gray-600" id="home-info">Managing tasks for your home</p>
                </div>
                
                <div id="tasks-container" class="divide-y divide-gray-100">
                    <!-- Tasks will appear here -->
                </div>

                <div class="p-6 bg-gray-50">
                    <button onclick="addCustomTask()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                        âž• Add Custom Task
                    </button>
                    <button onclick="exportTasks()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 ml-3">
                        ðŸ“„ Export Tasks
                    </button>
                    <button onclick="resetApp()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 ml-3">
                        ðŸ”„ Start Over
                    </button>
                </div>
            </div>
        </div>

        <!-- Add Task Modal -->
        <div id="task-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
            <div class="bg-white rounded-xl max-w-md w-full mx-4 p-6">
                <h3 class="text-xl font-bold mb-4">Add Task</h3>
                <div class="space-y-4">
                    <input type="text" id="new-task-title" placeholder="Task name" 
                           class="w-full p-3 border rounded-lg">
                    <select id="new-task-category" class="w-full p-3 border rounded-lg">
                        <option value="HVAC">HVAC</option>
                        <option value="Plumbing">Plumbing</option>
                        <option value="Exterior">Exterior</option>
                        <option value="Safety">Safety</option>
                        <option value="General">General</option>
                    </select>
                    <input type="number" id="new-task-cost" placeholder="Cost ($)" 
                           class="w-full p-3 border rounded-lg">
                    <textarea id="new-task-notes" placeholder="Notes" 
                              class="w-full p-3 border rounded-lg" rows="3"></textarea>
                </div>
                <div class="flex gap-3 mt-6">
                    <button onclick="closeModal()" class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-lg">
                        Cancel
                    </button>
                    <button onclick="saveNewTask()" class="flex-1 bg-blue-600 text-white py-2 rounded-lg">
                        Add Task
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('Script starting...');
        
        let homeData = {};
        let tasks = [];

        function createPlan() {
            console.log('createPlan() called');
            
            // Get form data
            const address = document.getElementById('address').value || 'Your Home';
            const yearBuilt = parseInt(document.getElementById('year-built').value) || 1995;
            const sqft = parseInt(document.getElementById('sqft').value) || 2000;
            const hasCentralAC = document.getElementById('central-ac').checked;
            const hasWellWater = document.getElementById('well-water').checked;
            const hasSeptic = document.getElementById('septic').checked;
            const hasFireplace = document.getElementById('fireplace').checked;

            console.log('Form data:', { address, yearBuilt, sqft, hasCentralAC, hasWellWater, hasSeptic, hasFireplace });

            homeData = {
                address,
                yearBuilt,
                sqft,
                hasCentralAC,
                hasWellWater,
                hasSeptic,
                hasFireplace
            };

            // Generate tasks
            tasks = [];
            let id = 1;

            // HVAC Tasks
            if (hasCentralAC) {
                tasks.push({
                    id: id++,
                    title: 'Replace HVAC Filter',
                    category: 'HVAC',
                    description: 'Replace air filter for central heating/cooling system',
                    frequency: 'Every 3 months',
                    cost: 25,
                    nextDue: getDateInFuture(30), // 30 days from now
                    status: 'pending'
                });

                tasks.push({
                    id: id++,
                    title: 'HVAC Annual Service',
                    category: 'HVAC',
                    description: 'Professional HVAC system maintenance and tune-up',
                    frequency: 'Annually',
                    cost: 150,
                    nextDue: getDateInFuture(60),
                    status: 'pending'
                });
            }

            // Water system tasks
            if (hasWellWater) {
                tasks.push({
                    id: id++,
                    title: 'Test Well Water',
                    category: 'Water Systems',
                    description: 'Annual water quality testing for bacteria and contaminants',
                    frequency: 'Annually',
                    cost: 75,
                    nextDue: getDateInFuture(90),
                    status: 'pending'
                });
            }

            if (hasSeptic) {
                tasks.push({
                    id: id++,
                    title: 'Septic Tank Pumping',
                    category: 'Water Systems',
                    description: 'Professional septic tank pumping and inspection',
                    frequency: 'Every 3-5 years',
                    cost: 400,
                    nextDue: getDateInFuture(120),
                    status: 'pending'
                });
            }

            // Fireplace
            if (hasFireplace) {
                tasks.push({
                    id: id++,
                    title: 'Chimney Cleaning',
                    category: 'Safety',
                    description: 'Professional chimney inspection and cleaning',
                    frequency: 'Annually',
                    cost: 300,
                    nextDue: getDateInFuture(45),
                    status: 'pending'
                });
            }

            // General tasks for everyone
            tasks.push({
                id: id++,
                title: 'Clean Gutters',
                category: 'Exterior',
                description: 'Remove debris from gutters and downspouts',
                frequency: 'Twice yearly',
                cost: 150,
                nextDue: getDateInFuture(21),
                status: 'pending'
            });

            tasks.push({
                id: id++,
                title: 'Test Smoke Detectors',
                category: 'Safety',
                description: 'Test smoke and carbon monoxide detectors',
                frequency: 'Monthly',
                cost: 0,
                nextDue: getDateInFuture(7),
                status: 'pending'
            });

            // Age-based tasks
            const homeAge = new Date().getFullYear() - yearBuilt;
            if (homeAge > 20) {
                tasks.push({
                    id: id++,
                    title: 'Roof Inspection',
                    category: 'Exterior',
                    description: 'Professional roof inspection for damage and wear',
                    frequency: 'Every 3 years',
                    cost: 250,
                    nextDue: getDateInFuture(180),
                    status: 'pending'
                });
            }

            console.log('Generated tasks:', tasks);

            // Show main app
            document.getElementById('setup-form').style.display = 'none';
            document.getElementById('main-app').classList.remove('hidden');

            // Update display
            document.getElementById('home-info').textContent = `Managing ${tasks.length} tasks for ${address}`;
            renderTasks();
            
            // Save data
            saveData();
            
            console.log('Plan created successfully!');
        }

        function getDateInFuture(days) {
            const date = new Date();
            date.setDate(date.getDate() + days);
            return date.toISOString().split('T')[0]; // Return YYYY-MM-DD format
        }

        function renderTasks() {
            console.log('Rendering tasks...');
            const container = document.getElementById('tasks-container');
            
            if (tasks.length === 0) {
                container.innerHTML = '<div class="p-6 text-center text-gray-500">No tasks yet</div>';
                return;
            }

            const tasksHTML = tasks.map(task => {
                const daysUntil = getDaysUntil(task.nextDue);
                const urgencyClass = daysUntil <= 7 ? 'bg-red-50 border-l-red-500' : 
                                   daysUntil <= 30 ? 'bg-orange-50 border-l-orange-500' : 
                                   'bg-blue-50 border-l-blue-500';

                return `
                    <div class="p-6 border-l-4 ${urgencyClass}">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h4 class="font-semibold text-gray-900 text-lg">${task.title}</h4>
                                <p class="text-gray-600 mt-1">${task.description}</p>
                                <div class="flex items-center gap-4 mt-2 text-sm text-gray-500">
                                    <span class="bg-gray-100 px-2 py-1 rounded">${task.category}</span>
                                    <span>${task.frequency}</span>
                                    <span>Due: ${new Date(task.nextDue).toLocaleDateString()}</span>
                                    <span class="font-medium ${daysUntil <= 7 ? 'text-red-600' : daysUntil <= 30 ? 'text-orange-600' : 'text-blue-600'}">
                                        ${daysUntil <= 0 ? 'Overdue!' : daysUntil === 1 ? '1 day' : `${daysUntil} days`}
                                    </span>
                                    ${task.cost > 0 ? `<span>$${task.cost}</span>` : '<span>DIY</span>'}
                                </div>
                            </div>
                            <div class="flex gap-2 ml-4">
                                <button onclick="completeTask(${task.id})" 
                                        class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
                                    Complete
                                </button>
                                <button onclick="deleteTask(${task.id})" 
                                        class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">
                                    Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = tasksHTML;
            console.log('Tasks rendered successfully');
        }

        function getDaysUntil(dateStr) {
            const today = new Date();
            const dueDate = new Date(dateStr);
            const diffTime = dueDate - today;
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        }

        function completeTask(taskId) {
            console.log('Completing task:', taskId);
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                // Move due date forward based on frequency
                const currentDue = new Date(task.nextDue);
                let newDue = new Date(currentDue);
                
                if (task.frequency.includes('month')) {
                    const months = task.frequency.includes('3') ? 3 : 1;
                    newDue.setMonth(newDue.getMonth() + months);
                } else if (task.frequency.includes('year')) {
                    newDue.setFullYear(newDue.getFullYear() + 1);
                } else if (task.frequency.includes('Twice')) {
                    newDue.setMonth(newDue.getMonth() + 6);
                } else {
                    newDue.setMonth(newDue.getMonth() + 1); // Default to monthly
                }
                
                task.nextDue = newDue.toISOString().split('T')[0];
                renderTasks();
                saveData();
                alert(`âœ… "${task.title}" completed! Next due: ${newDue.toLocaleDateString()}`);
            }
        }

        function deleteTask(taskId) {
            if (confirm('Are you sure you want to delete this task?')) {
                tasks = tasks.filter(t => t.id !== taskId);
                renderTasks();
                saveData();
            }
        }

        function addCustomTask() {
            document.getElementById('task-modal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('task-modal').classList.add('hidden');
            // Clear form
            document.getElementById('new-task-title').value = '';
            document.getElementById('new-task-category').value = 'General';
            document.getElementById('new-task-cost').value = '';
            document.getElementById('new-task-notes').value = '';
        }

        function saveNewTask() {
            const title = document.getElementById('new-task-title').value.trim();
            const category = document.getElementById('new-task-category').value;
            const cost = parseFloat(document.getElementById('new-task-cost').value) || 0;
            const notes = document.getElementById('new-task-notes').value.trim();

            if (!title) {
                alert('Please enter a task title');
                return;
            }

            const newTask = {
                id: Math.max(...tasks.map(t => t.id), 0) + 1,
                title: title,
                category: category,
                description: notes || 'Custom maintenance task',
                frequency: 'As needed',
                cost: cost,
                nextDue: getDateInFuture(30),
                status: 'pending'
            };

            tasks.push(newTask);
            renderTasks();
            saveData();
            closeModal();
        }

        function exportTasks() {
            const data = {
                homeData: homeData,
                tasks: tasks,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `casa-care-tasks-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function resetApp() {
            if (confirm('This will clear all your data and start over. Continue?')) {
                localStorage.removeItem('casaCareData');
                location.reload();
            }
        }

        function saveData() {
            try {
                const data = {
                    homeData: homeData,
                    tasks: tasks,
                    lastSaved: new Date().toISOString()
                };
                localStorage.setItem('casaCareData', JSON.stringify(data));
                console.log('Data saved successfully');
            } catch (error) {
                console.error('Error saving data:', error);
            }
        }

        function loadData() {
            try {
                const saved = localStorage.getItem('casaCareData');
                if (saved) {
                    const data = JSON.parse(saved);
                    homeData = data.homeData || {};
                    tasks = data.tasks || [];
                    console.log('Data loaded:', data);
                    return true;
                }
            } catch (error) {
                console.error('Error loading data:', error);
            }
            return false;
        }

        // Initialize app
        function initApp() {
            console.log('Initializing app...');
            
            if (loadData() && tasks.length > 0) {
                console.log('Found saved data, showing main app');
                document.getElementById('setup-form').style.display = 'none';
                document.getElementById('main-app').classList.remove('hidden');
                document.getElementById('home-info').textContent = `Managing ${tasks.length} tasks for ${homeData.address || 'your home'}`;
                renderTasks();
            } else {
                console.log('No saved data, showing setup form');
                document.getElementById('setup-form').style.display = 'block';
            }
        }

        // Start the app when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, starting app...');
            initApp();
        });

        console.log('Script loaded successfully');
    </script>
</body>
</html>
